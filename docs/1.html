<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    #app {
      width: 400px;
      height: 400px;
      position: relative;
      margin: 0 auto;
    }
    .circle {
      border-radius: 100%;
      position: absolute;
    }
  </style>
</head>
<body>
  <div id="app"></div>
  <script>
    function randomColor() {
      return `#${Math.random().toString(16).slice(2, 8)}`
    }
    function findKeyframesRule(rule) {
      //此处过滤非同源的styleSheet，因为非同源的无法访问cssRules，会报错
      var ss = Array.from(document.styleSheets).filter((styleSheet) => !styleSheet.href || styleSheet.href.startsWith(window.location.origin))
      for (var i = 0; i < ss.length; ++i) {
        for (var j = 0; j < ss[i].cssRules.length; ++j) {
          if (ss[i].cssRules[j].type === window.CSSRule.KEYFRAMES_RULE && ss[i].cssRules[j].name === rule) {
            return ss[i]
          }
        }
      }
      return null
    }

    function init () {
      let dom = ''
      let currStyle = document.styleSheets[0]
      let token = window.WebKitCSSKeyframesRule ? '-webkit-' : ''
      let baseMove = 600
      for (let i = 0; i < 20; i++) {
        let randomWH = Math.floor(Math.random() * 100)
        let top = Math.floor(Math.random() * baseMove)
        let left = Math.floor(Math.random() * baseMove)
        let moveTop = Math.floor(Math.random() * baseMove)
        let moveLeft = Math.floor(Math.random() * baseMove)
        currStyle.insertRule(`@${token}keyframes moveX${i} { 0% { left: ${left}px;} 100% { left: ${moveLeft}px; } }`);
        currStyle.insertRule(`@${token}keyframes moveY${i} { 0% { top: ${top}px;} 100% { top: ${moveTop}px; } }`);
        let style = `background-color: ${randomColor()};`
        style += `width: ${randomWH}px; height: ${randomWH}px;`
        style += `left: ${left * i}px; top: ${top * i}px;`
        style += `animation: moveX${i} 4s cubic-bezier(0.36,0,0.64,1) -2s infinite alternate, moveY${i} 4s cubic-bezier(0.36,0,0.64,1) 0s infinite alternate;`
        dom += `<div class="circle" style="${style}"></div>`
      }
      document.getElementById('app').innerHTML = dom
    }
    init()
  </script>
</body>
</html>