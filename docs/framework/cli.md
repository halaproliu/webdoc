# ä» 0 æ„å»ºè‡ªå·±çš„è„šæ‰‹æ¶CLIçŸ¥è¯†ä½“ç³»ï¼ˆä¸‡å­—ï¼‰

æ­å»ºè„šæ‰‹æ¶çš„ç›®çš„å°±æ˜¯**å¿«é€Ÿçš„æ­å»ºé¡¹ç›®çš„åŸºæœ¬ç»“æ„å¹¶æä¾›é¡¹ç›®è§„èŒƒå’Œçº¦å®š**ã€‚ç›®å‰æ—¥å¸¸å·¥ä½œä¸­å¸¸ç”¨çš„è„šæ‰‹æ¶æœ‰ vue-cliã€create-react-appã€angular-cli ç­‰ç­‰ï¼Œéƒ½æ˜¯é€šè¿‡ç®€å•çš„åˆå§‹åŒ–å‘½ä»¤ï¼Œå®Œæˆå†…å®¹çš„å¿«é€Ÿæ„å»ºã€‚

è„šæ‰‹æ¶æ˜¯æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„å·¥å…·ï¼Œä¹Ÿæ˜¯å›¢é˜Ÿææ•ˆçš„é‡è¦æ‰‹æ®µã€‚æ‰€ä»¥ç³»ç»Ÿæ€§çš„æŒæ¡è„šæ‰‹æ¶ç›¸å…³çŸ¥è¯†ï¼Œå¯¹å‰ç«¯å¼€å‘è€…æ¥è¯´æ˜¯éå¸¸é‡è¦çš„ï¼Œå³ä½¿å¾ˆå¤šäººä»Šåä¸ä¸€å®šéƒ½ä¼šå‚ä¸åˆ°å„è‡ªéƒ¨é—¨æˆ–è€…å…¬å¸çš„åŸºå»ºå·¥ä½œï¼Œä½†æ˜¯ç³»ç»Ÿæ€§æŒæ¡å¥½è¿™ä¸ªæŠ€èƒ½ä¹Ÿå¯ä»¥æ–¹ä¾¿æˆ‘ä»¬åæœŸçš„æºç é˜…è¯»ã€‚**ä¸‹é¢å°±ä¸€èµ·æ¥äº†è§£ä¸€ä¸‹å§** ğŸ˜‰

## ä¸€ã€è„šæ‰‹æ¶çš„ç®€å•é›å½¢ ğŸ£

> **è„šæ‰‹æ¶å°±æ˜¯åœ¨å¯åŠ¨çš„æ—¶å€™è¯¢é—®ä¸€äº›ç®€å•çš„é—®é¢˜ï¼Œå¹¶ä¸”é€šè¿‡ç”¨æˆ·å›ç­”çš„ç»“æœå»æ¸²æŸ“å¯¹åº”çš„æ¨¡æ¿æ–‡ä»¶**ï¼ŒåŸºæœ¬å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š
> 
> 1.  é€šè¿‡å‘½ä»¤è¡Œäº¤äº’è¯¢é—®ç”¨æˆ·é—®é¢˜
> 2.  æ ¹æ®ç”¨æˆ·å›ç­”çš„ç»“æœç”Ÿæˆæ–‡ä»¶

ä¾‹å¦‚æˆ‘ä»¬åœ¨ä½¿ç”¨ [vue-cli](https://link.juejin.cn/?target=https%3A%2F%2Fcli.vuejs.org%2Fzh%2Fguide%2Fcreating-a-project.html "https://cli.vuejs.org/zh/guide/creating-a-project.html") åˆ›å»ºä¸€ä¸ª vue é¡¹ç›®æ—¶çš„æ—¶å€™ ğŸ‘‡

**step1ï¼šè¿è¡Œåˆ›å»ºå‘½ä»¤**

```
$ vue create hello-world
```

**step2ï¼šè¯¢é—®ç”¨æˆ·é—®é¢˜**

![cli-new-project.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/112909c003634b48a2e3f5e9be15501e~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

![cli-select-features.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9ebe1cdcdc004beaa74058b42e14136a~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

**step3ï¼šç”Ÿæˆç¬¦åˆç”¨æˆ·éœ€æ±‚çš„é¡¹ç›®æ–‡ä»¶**

```
# å¿½ç•¥éƒ¨åˆ†æ–‡ä»¶å¤¹
vue-project
â”œâ”€ index.html
â”œâ”€ src
â”‚  â”œâ”€ App.vue
â”‚  â”œâ”€ assets
â”‚  â”‚  â””â”€ logo.png
â”‚  â”œâ”€ components
â”‚  â”‚  â””â”€ HelloWorld.vue
â”‚  â”œâ”€ main.js
â”‚  â””â”€ router
â”‚     â””â”€ index.js
â””â”€ package.json
```

å‚è€ƒä¸Šé¢çš„æµç¨‹æˆ‘ä»¬å¯ä»¥è‡ªå·±æ¥ **æ­å»ºä¸€ä¸ªç®€å•çš„è„šæ‰‹æ¶é›å½¢**

### 1\. åœ¨å‘½ä»¤è¡Œå¯åŠ¨ cli

**ç›®æ ‡ï¼š** å®ç°åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ `my-node-cli` æ¥å¯åŠ¨æˆ‘ä»¬çš„è„šæ‰‹æ¶

#### 1.1 æ–°å»ºé¡¹ç›®ç›®å½• my-node-cli

```
$ mkdir my-node-cli 
$ cd my-node-cli 
$ npm init # ç”Ÿæˆ package.json æ–‡ä»¶
```

#### 1.2 æ–°å»ºç¨‹åºå…¥å£æ–‡ä»¶ cli.js

```
$ touch cli.js # æ–°å»º cli.js æ–‡ä»¶
```

åœ¨ package.json æ–‡ä»¶ä¸­æŒ‡å®šå…¥å£æ–‡ä»¶ä¸º cli.js ğŸ‘‡

```
{
  "name": "my-node-cli",
  "version": "1.0.0",
  "description": "",
  "main": "cli.js",
  "bin": "cli.js", // æ‰‹åŠ¨æ·»åŠ å…¥å£æ–‡ä»¶ä¸º cli.js
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "",
  "license": "ISC"
}
```

æ­¤æ—¶é¡¹ç›®ç›®å½•ç»“æ„ï¼š

```
my-node-cli      
â”œâ”€ cli.js        
â””â”€ package.json     
```

æ‰“å¼€ cli.js è¿›è¡Œç¼–è¾‘

```
#! /usr/bin/env node

// #! ç¬¦å·çš„åç§°å« Shebangï¼Œç”¨äºæŒ‡å®šè„šæœ¬çš„è§£é‡Šç¨‹åº
// Node CLI åº”ç”¨å…¥å£æ–‡ä»¶å¿…é¡»è¦æœ‰è¿™æ ·çš„æ–‡ä»¶å¤´
// å¦‚æœæ˜¯Linux æˆ–è€… macOS ç³»ç»Ÿä¸‹è¿˜éœ€è¦ä¿®æ”¹æ­¤æ–‡ä»¶çš„è¯»å†™æƒé™ä¸º 755
// å…·ä½“å°±æ˜¯é€šè¿‡ chmod 755 cli.js å®ç°ä¿®æ”¹

// ç”¨äºæ£€æŸ¥å…¥å£æ–‡ä»¶æ˜¯å¦æ­£å¸¸æ‰§è¡Œ
console.log('my-node-cli working~')
```

#### 1.3 npm link é“¾æ¥åˆ°å…¨å±€

```
$ npm link # or yarn link
```

æ‰§è¡Œå®Œæˆ âœ…

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0fb239ce03784d81b57e1bfa5fee09d9~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

æˆ‘ä»¬å°±å¯ä»¥æ¥æµ‹è¯•äº†ï¼Œåœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ my-node-cli æ‰§è¡Œä¸€ä¸‹

```
$ my-node-cli
```

è¿™é‡Œæˆ‘ä»¬å°±çœ‹åˆ°å‘½ä»¤è¡Œä¸­æ‰“å°äº†

```
my-node-cli working~
```

å®Œæˆ âœ”ï¼Œæ¥ä¸‹æ¥

### 2\. è¯¢é—®ç”¨æˆ·ä¿¡æ¯

å®ç°ä¸è¯¢é—®ç”¨æˆ·ä¿¡æ¯çš„åŠŸèƒ½éœ€è¦å¼•å…¥ inquirer.js ğŸ‘‰ [æ–‡æ¡£çœ‹è¿™é‡Œ](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FSBoudrias%2FInquirer.js%2F "https://github.com/SBoudrias/Inquirer.js/")

```
$ npm install inquirer --dev # yarn add inquirer --dev
```

æ¥ç€æˆ‘ä»¬åœ¨ cli.js æ¥è®¾ç½®æˆ‘ä»¬çš„é—®é¢˜

```
#! /usr/bin/env node

const inquirer = require('inquirer')

inquirer.prompt([
  {
    type: 'input', //typeï¼š input, number, confirm, list, checkbox ... 
    name: 'name', // key å
    message: 'Your name', // æç¤ºä¿¡æ¯
    default: 'my-node-cli' // é»˜è®¤å€¼
  }
]).then(answers => {
  // æ‰“å°äº’ç”¨è¾“å…¥ç»“æœ
  console.log(answers)
})

```

åœ¨å‘½ä»¤è¡Œè¾“å…¥ my-node-cli çœ‹ä¸€ä¸‹æ‰§è¡Œç»“æœ

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5b5cfbbc3be84045a25ac7da91ae5b05~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

è¿™é‡Œæˆ‘ä»¬å°±æ‹¿åˆ°äº†ç”¨æˆ·è¾“å…¥çš„é¡¹ç›®åç§° `{ name: 'my-app' }`, ğŸ‘Œ

### 3\. ç”Ÿæˆå¯¹åº”çš„æ–‡ä»¶

#### 3.1 æ–°å»ºæ¨¡ç‰ˆæ–‡ä»¶å¤¹

```
$ mkdir templates # åˆ›å»ºæ¨¡ç‰ˆæ–‡ä»¶å¤¹ 
```

#### 3.2 æ–°å»º index.html å’Œ common.css ä¸¤ä¸ªç®€å•çš„ç¤ºä¾‹æ–‡ä»¶

```
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
    <!-- ejs è¯­æ³• -->
    <%= name %>
  </title>
</head>
<body>
  <h1><%= name %></h1>
</body>

</html>
```

```
/* common.css */
body {
  margin: 20px auto;
  background-color: azure;
}
```

æ­¤æ—¶çš„ç›®å½•ç»“æ„

```
my-node-cli           
â”œâ”€ templates          
â”‚  â”œâ”€ common.css      
â”‚  â””â”€ index.html      
â”œâ”€ cli.js             
â”œâ”€ package-lock.json  
â””â”€ package.json       
```

#### 3.3 æ¥ç€å®Œå–„æ–‡ä»¶ç”Ÿæˆé€»è¾‘

è¿™é‡Œå€ŸåŠ© ejs æ¨¡ç‰ˆå¼•æ“å°†ç”¨æˆ·è¾“å…¥çš„æ•°æ®æ¸²æŸ“åˆ°æ¨¡ç‰ˆæ–‡ä»¶ä¸Š

```
npm install ejs --save # yarn add ejs --save
```

å®Œå–„ååˆ° cli.js ğŸ‘‡

```
#! /usr/bin/env node

const inquirer = require('inquirer')
const path = require('path')
const fs = require('fs')
const ejs = require('ejs')

inquirer.prompt([
  {
    type: 'input', //typeï¼šinput,confirm,list,rawlist,checkbox,password...
    name: 'name', // key å
    message: 'Your name', // æç¤ºä¿¡æ¯
    default: 'my-node-cli' // é»˜è®¤å€¼
  }
]).then(answers => {
  // æ¨¡ç‰ˆæ–‡ä»¶ç›®å½•
  const destUrl = path.join(__dirname, 'templates'); 
  // ç”Ÿæˆæ–‡ä»¶ç›®å½•
  // process.cwd() å¯¹åº”æ§åˆ¶å°æ‰€åœ¨ç›®å½•
  const cwdUrl = process.cwd();
  // ä»æ¨¡ç‰ˆç›®å½•ä¸­è¯»å–æ–‡ä»¶
  fs.readdir(destUrl, (err, files) => {
    if (err) throw err;
    files.forEach((file) => {
      // ä½¿ç”¨ ejs æ¸²æŸ“å¯¹åº”çš„æ¨¡ç‰ˆæ–‡ä»¶
      // renderFileï¼ˆæ¨¡ç‰ˆæ–‡ä»¶åœ°å€ï¼Œä¼ å…¥æ¸²æŸ“æ•°æ®ï¼‰
      ejs.renderFile(path.join(destUrl, file), answers).then(data => {
        // ç”Ÿæˆ ejs å¤„ç†åçš„æ¨¡ç‰ˆæ–‡ä»¶
        fs.writeFileSync(path.join(cwdUrl, file) , data)
      })
    })
  })
})
```

åŒæ ·ï¼Œåœ¨æ§åˆ¶å°æ‰§è¡Œä¸€ä¸‹ my-node-cli ï¼Œæ­¤æ—¶ `index.html`ã€`common.css` å·²ç»æˆåŠŸåˆ›å»º âœ”

æˆ‘ä»¬æ‰“å°ä¸€ä¸‹å½“å‰çš„ç›®å½•ç»“æ„ ğŸ‘‡

```
my-node-cli           
â”œâ”€ templates          
â”‚  â”œâ”€ common.css      
â”‚  â””â”€ index.html      
â”œâ”€ cli.js             
â”œâ”€ common.css .................... ç”Ÿæˆå¯¹åº”çš„ common.css æ–‡ä»¶        
â”œâ”€ index.html .................... ç”Ÿæˆå¯¹åº”çš„ index.html æ–‡ä»¶        
â”œâ”€ package-lock.json  
â””â”€ package.json       
```

æ‰“å¼€ç”Ÿæˆçš„ index.html æ–‡ä»¶çœ‹ä¸€ä¸‹

```
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- ejs è¯­æ³• -->
  <title>
    my-app
  </title>
</head>

<body>
  <h1>my-app</h1>
</body>

</html>
```

ç”¨æˆ·è¾“å…¥çš„ `{ name: 'my-app' }` å·²ç»æ·»åŠ åˆ°äº†ç”Ÿæˆçš„æ–‡ä»¶ä¸­äº† âœŒï¸

ç‚¹æ­¤æ‰“å¼€ ğŸ‘‰ [my-node-cli æºç åœ°å€](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FT-Roc%2Fmy-node-cli "https://github.com/T-Roc/my-node-cli")

## äºŒã€çƒ­é—¨è„šæ‰‹æ¶å·¥å…·åº“ ğŸ”§

å®é™…ç”Ÿäº§ä¸­æ­å»ºä¸€ä¸ªè„šæ‰‹æ¶æˆ–è€…é˜…è¯»å…¶ä»–è„šæ‰‹æ¶æºç çš„æ—¶å€™éœ€è¦äº†è§£ä¸‹é¢è¿™äº›å·¥å…·åº“ ğŸ‘‡

| åç§° | ç®€ä»‹ |
| --- | --- |
| [commander](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Ftj%2Fcommander.js%2Fblob%2Fmaster%2FReadme_zh-CN.md "https://github.com/tj/commander.js/blob/master/Readme_zh-CN.md") | å‘½ä»¤è¡Œè‡ªå®šä¹‰æŒ‡ä»¤ |
| [inquirer](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FSBoudrias%2FInquirer.js%2F "https://github.com/SBoudrias/Inquirer.js/") | å‘½ä»¤è¡Œè¯¢é—®ç”¨æˆ·é—®é¢˜ï¼Œè®°å½•å›ç­”ç»“æœ |
| [chalk](https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fchalk "https://www.npmjs.com/package/chalk") | æ§åˆ¶å°è¾“å‡ºå†…å®¹æ ·å¼ç¾åŒ– |
| [ora](https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fora "https://www.npmjs.com/package/ora") | æ§åˆ¶å° loading æ ·å¼ |
| [figlet](https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Ffiglet "https://www.npmjs.com/package/figlet") | æ§åˆ¶å°æ‰“å° logo |
| [easy-table](https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Feasy-table "https://www.npmjs.com/package/easy-table") | æ§åˆ¶å°è¾“å‡ºè¡¨æ ¼ |
| [download-git-repo](https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fdownload-git-repo "https://www.npmjs.com/package/download-git-repo") | ä¸‹è½½è¿œç¨‹æ¨¡ç‰ˆ |
| [fs-extra](https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Ffs-extra "https://www.npmjs.com/package/fs-extra") | ç³»ç»Ÿfsæ¨¡å—çš„æ‰©å±•ï¼Œæä¾›äº†æ›´å¤šä¾¿åˆ©çš„ APIï¼Œå¹¶ç»§æ‰¿äº†fsæ¨¡å—çš„ API |
| [cross-spawn](https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fcross-spawn "https://www.npmjs.com/package/cross-spawn") | æ”¯æŒè·¨å¹³å°è°ƒç”¨ç³»ç»Ÿä¸Šçš„å‘½ä»¤ |

é‡ç‚¹ä»‹ç»ä¸‹é¢è¿™äº›ï¼Œå…¶ä»–å·¥å…·å¯ä»¥æŸ¥çœ‹è¯´æ˜æ–‡æ¡£

### 1\. commander è‡ªå®šä¹‰å‘½ä»¤è¡ŒæŒ‡ä»¤

æ›´å¤šç”¨æ³• ğŸ‘‰ [ä¸­æ–‡æ–‡æ¡£](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Ftj%2Fcommander.js%2Fblob%2Fmaster%2FReadme_zh-CN.md "https://github.com/tj/commander.js/blob/master/Readme_zh-CN.md")

ç®€å•æ¡ˆä¾‹ ğŸ‘‡

#### 1.1 æ–°å»ºä¸€ä¸ªç®€å•çš„ Node Cli é¡¹ç›®

```
// package.json
{
  "name": "my-vue",
  "version": "1.0.0",
  "description": "",
  "bin": "./bin/cli.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "T-Roc",
  "license": "ISC",
  "devDependencies": {
    "commander": "^7.2.0"
  }
}
```

ç›®å½•ç»“æ„ï¼š

```
npms-demo             
â”œâ”€ bin                
â”‚  â””â”€ cli.js          
â”œâ”€ package-lock.json  
â””â”€ package.json              
```

#### 1.3 å¼•å…¥ commander ç¼–å†™ä»£ç 

```
# å®‰è£…ä¾èµ–
npm install commander # yarn add commander 
```

å®Œå–„ bin.js ä»£ç 

```
#! /usr/bin/env node

const program = require('commander')

program
.version('0.1.0')
.command('create <name>')
.description('create a new project')
.action(name => { 
    // æ‰“å°å‘½ä»¤è¡Œè¾“å…¥çš„å€¼
    console.log("project name is " + name)
})

program.parse()
```

#### 1.3 npm link é“¾æ¥åˆ°å…¨å±€

-   æ‰§è¡Œ `npm link` å°†åº”ç”¨ `my-vue` é“¾æ¥åˆ°å…¨å±€
-   å®Œæˆä¹‹åï¼Œåœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ `my-vue`

çœ‹ä¸€ä¸‹ï¼Œå‘½ä»¤è¡Œä¸­çš„è¾“å‡ºå†…å®¹ ğŸ‘‡

```
~/Desktop/cli/npms-demo ->my-vue

Usage: my-vue [options] [command]

Options:
  -V, --version   output the version number
  -h, --help      display help for command

Commands:
  create <name>   create a new project
  help [command]  display help for command
```

è¿™ä¸ªæ—¶å€™å°±æœ‰äº† `my-vue` å‘½ä»¤ä½¿ç”¨çš„è¯´æ˜ä¿¡æ¯ï¼Œåœ¨ Commands ä¸‹é¢å‡ºç°äº†æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ create å‘½ä»¤ `create <name>`ï¼Œæˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œä¸€ä¸‹

```
~/Desktop/cli/npms-demo ->my-vue create my-app
project name is my-app
```

è¿™ä¸ªæ—¶å€™æ§åˆ¶å°å°±æ‰“å°å‡ºæ¥ create å‘½ä»¤åé¢çš„ `<name>` å€¼ `my-app` ğŸ‘

### 2\. chalk å‘½ä»¤è¡Œç¾åŒ–å·¥å…·

chalkï¼ˆç²‰ç¬”ï¼‰å¯ä»¥**ç¾åŒ–æˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸­è¾“å‡ºå†…å®¹çš„æ ·å¼**ï¼Œä¾‹å¦‚å¯¹é‡ç‚¹ä¿¡æ¯æ·»åŠ é¢œè‰²

#### 2.1 å®‰è£…ä¾èµ–

```
npm install chalk # yarn add chalk
```

#### 2.2 åŸºæœ¬ä½¿ç”¨

åœ¨ npms-demo é¡¹ç›®ä¸­æ‰“å¼€ bin/cli.js

```
#! /usr/bin/env node

const program = require('commander')
const chalk = require('chalk')

program
.version('0.1.0')
.command('create <name>')
.description('create a new project')
.action(name => { 
    // æ‰“å°å‘½ä»¤è¡Œè¾“å…¥çš„å€¼

    // æ–‡æœ¬æ ·å¼
    console.log("project name is " + chalk.bold(name))

    // é¢œè‰²
    console.log("project name is " + chalk.cyan(name))
    console.log("project name is " + chalk.green(name))

    // èƒŒæ™¯è‰²
    console.log("project name is " + chalk.bgRed(name))

    // ä½¿ç”¨RGBé¢œè‰²è¾“å‡º
    console.log("project name is " + chalk.rgb(4, 156, 219).underline(name));
    console.log("project name is " + chalk.hex('#049CDB').bold(name));
    console.log("project name is " + chalk.bgHex('#049CDB').bold(name))
})

program.parse()
```

åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œé¡¹ç›® `my-vue create my-app` çœ‹ä¸€ä¸‹æ•ˆæœ

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c93b32477ee741688a3439d387d622ca~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

å…·ä½“çš„æ ·å¼å¯¹ç…§è¡¨å¦‚ä¸‹ ğŸ‘‡

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6ee03ccfefa54bf38900cd372560c927~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

### 3\. inquirer å‘½ä»¤è¡Œäº¤äº’å·¥å…·

æ›´å¤šç”¨æ³• ğŸ‘‰ [æ–‡æ¡£åœ°å€](https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Finquirer "https://www.npmjs.com/package/inquirer")

inquirer åœ¨è„šæ‰‹æ¶å·¥å…·ä¸­çš„**ä½¿ç”¨é¢‘ç‡æ˜¯éå¸¸é«˜**çš„ï¼Œå…¶å®åœ¨ä¸Šæ–‡**è„šæ‰‹æ¶çš„ç®€å•é›å½¢**ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨åˆ°äº†ï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šä»‹ç»äº†ã€‚

### 4\. ora å‘½ä»¤è¡Œ loading åŠ¨æ•ˆ

æ›´å¤šç”¨æ³• ğŸ‘‰ [æ–‡æ¡£åœ°å€](https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fora "https://www.npmjs.com/package/ora")

```
// è‡ªå®šä¹‰æ–‡æœ¬ä¿¡æ¯
const message = 'Loading unicorns'
// åˆå§‹åŒ–
const spinner = ora(message);
// å¼€å§‹åŠ è½½åŠ¨ç”»
spinner.start();

setTimeout(() => {
    // ä¿®æ”¹åŠ¨ç”»æ ·å¼

    // Type: string
    // Default: 'cyan'
    // Values: 'black' | 'red' | 'green' | 'yellow' | 'blue' | 'magenta' | 'cyan' | 'white' | 'gray'
    spinner.color = 'red';    
    spinner.text = 'Loading rainbows';

    setTimeout(() => {
        // åŠ è½½çŠ¶æ€ä¿®æ”¹
        spinner.stop() // åœæ­¢
        spinner.succeed('Loading succeed'); // æˆåŠŸ âœ”
        // spinner.fail(text?);  å¤±è´¥ âœ–
        // spinner.warn(text?);  æç¤º âš 
        // spinner.info(text?);  ä¿¡æ¯ â„¹
    }, 2000);
}, 2000);
```

å‘½ä»¤è¡Œæ˜¯è¾“å‡ºæ•ˆæœå¦‚ä¸‹

![QQ20210516-173914-HD.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/71843c4048f843dabfc0d679b5e608a9~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

### 5\. cross-spawn è·¨å¹³å° shell å·¥å…·

æ›´å¤šç”¨æ³• ğŸ‘‰ [æ–‡æ¡£åœ°å€](https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fcross-spawn "https://www.npmjs.com/package/cross-spawn")

åœ¨è„šæ‰‹æ¶é‡Œé¢ï¼Œå¯ä»¥ç”¨æ¥è‡ªåŠ¨æ‰§è¡Œ shell å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š

```
#! /usr/bin/env node 

const spawn = require('cross-spawn');
const chalk = require('chalk')

// å®šä¹‰éœ€è¦æŒ‰ç…§çš„ä¾èµ–
const dependencies = ['vue', 'vuex', 'vue-router'];

// æ‰§è¡Œå®‰è£…
const child = spawn('npm', ['install', '-D'].concat(dependencies), { 
    stdio: 'inherit' 
});

// ç›‘å¬æ‰§è¡Œç»“æœ
child.on('close', function(code) {
    // æ‰§è¡Œå¤±è´¥
    if(code !== 0) {
        console.log(chalk.red('Error occurred while installing dependencies!'));
        process.exit(1);
    }
    // æ‰§è¡ŒæˆåŠŸ
    else {
        console.log(chalk.cyan('Install finished'))   
    }
})
```

åŒæ ·çš„åœ¨å‘½ä»¤è¡Œæ‰§è¡Œä¸€ä¸‹ `my-vue` çœ‹ä¸€ä¸‹æ‰§è¡Œç»“æœ

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d805fb04d6cb46719b9578c3baa6631b~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

æˆåŠŸå®‰è£… ğŸ‘

## ä¸‰ã€æ­å»ºè‡ªå·±çš„è„šæ‰‹æ¶ ğŸ—

å…ˆç»™æˆ‘ä»¬çš„è„šæ‰‹æ¶èµ·ä¸ªåå­—å§ï¼Œæ­£å¥½ç¥èå·ç™»é™†äº†ç«æ˜Ÿï¼Œä¸å¦‚å°±å«ï¼š**zhurong-cli** ğŸ˜†

```
   .-') _  ('-. .-.             _  .-')                    .-') _             
  (  OO) )( OO )  /            ( \( -O )                  ( OO ) )            
,(_)----. ,--. ,--. ,--. ,--.   ,------.  .-'),-----. ,--./ ,--,'  ,----.     
|       | |  | |  | |  | |  |   |   /`. '( OO'  .-.  '|   \ |  |\ '  .-./-')  
'--.   /  |   .|  | |  | | .-') |  /  | |/   |  | |  ||    \|  | )|  |_( O- ) 
(_/   /   |       | |  |_|( OO )|  |_.' |\_) |  |\|  ||  .     |/ |  | .--, \ 
 /   /___ |  .-.  | |  | | `-' /|  .  '.'  \ |  | |  ||  |\    | (|  | '. (_/ 
|        ||  | |  |('  '-'(_.-' |  |\  \    `'  '-'  '|  | \   |  |  '--'  |  
`--------'`--' `--'  `-----'    `--' '--'     `-----' `--'  `--'   `------' 
```

**éœ€è¦å®ç°å“ªäº›åŸºæœ¬åŠŸèƒ½ï¼š**

1.  é€šè¿‡ `zr create <name>` å‘½ä»¤å¯åŠ¨é¡¹ç›®
2.  è¯¢é—®ç”¨æˆ·éœ€è¦é€‰æ‹©éœ€è¦ä¸‹è½½çš„æ¨¡æ¿
3.  è¿œç¨‹æ‹‰å–æ¨¡æ¿æ–‡ä»¶

**æ­å»ºæ­¥éª¤æ‹†è§£ï¼š**

1.  åˆ›å»ºé¡¹ç›®
2.  åˆ›å»ºè„šæ‰‹æ¶å¯åŠ¨å‘½ä»¤ï¼ˆä½¿ç”¨ commanderï¼‰
3.  è¯¢é—®ç”¨æˆ·é—®é¢˜è·å–åˆ›å»ºæ‰€éœ€ä¿¡æ¯ï¼ˆä½¿ç”¨ inquirerï¼‰
4.  ä¸‹è½½è¿œç¨‹æ¨¡æ¿ï¼ˆä½¿ç”¨ download-git-repoï¼‰
5.  å‘å¸ƒé¡¹ç›®

### 1\. åˆ›å»ºé¡¹ç›®

å‚ç…§å‰é¢çš„ä¾‹å­ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªç®€å•çš„ Node-Cli ç»“æ„

```
zhurong-cli           
â”œâ”€ bin                
â”‚  â””â”€ cli.js  # å¯åŠ¨æ–‡ä»¶      
â”œâ”€ README.md          
â””â”€ package.json       
```

é…ç½®è„šæ‰‹æ¶å¯åŠ¨æ–‡ä»¶

```
{
  "name": "zhurong-cli",
  "version": "1.0.0",
  "description": "simple vue cli",
  "main": "index.js",
  "bin": {
    "zr": "./bin/cli.js" // é…ç½®å¯åŠ¨æ–‡ä»¶è·¯å¾„ï¼Œzr ä¸ºåˆ«å
  },
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": {
    "name": "T-Roc",
    "email": "lxp_work@163.com"
  },
  "license": "MIT"
}
```

ç®€å•ç¼–è¾‘ä¸€ä¸‹æˆ‘ä»¬çš„ cli.js

```
#! /usr/bin/env node

console.log('zhurong-cli working ~')
```

ä¸ºäº†æ–¹ä¾¿å¼€å‘è°ƒè¯•ï¼Œä½¿ç”¨ `npm link` é“¾æ¥åˆ°å…¨å±€

```
~/Desktop/cli/zhurong-cli ->npm link
npm WARN zhurong-cli@1.0.0 No repository field.

up to date in 1.327s
found 0 vulnerabilities

/usr/local/bin/zr -> /usr/local/lib/node_modules/zhurong-cli/bin/cli.js
/usr/local/lib/node_modules/zhurong-cli -> /Users/Desktop/cli/zhurong-cli
```

å®Œæˆä¹‹åï¼Œæ¥ç€æµ‹è¯•ä¸€ä¸‹

```
~/Desktop/cli/zhurong-cli ->zr
zhurong-cli working ~ # æ‰“å°å†…å®¹
```

OKï¼Œå¾—åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„æ‰“å°å†…å®¹ï¼Œæ¥ä¸‹æ¥

### 2\. åˆ›å»ºè„šæ‰‹æ¶å¯åŠ¨å‘½ä»¤

**ç®€å•åˆ†æä¸€ä¸‹æˆ‘ä»¬è¦æ€ä¹ˆåšï¼Ÿ**

1.  é¦–å…ˆæˆ‘ä»¬è¦å€ŸåŠ© commander ä¾èµ–å»å®ç°è¿™ä¸ªéœ€æ±‚
2.  å‚ç…§ vue-cli å¸¸ç”¨çš„å‘½ä»¤æœ‰ createã€config ç­‰ç­‰ï¼Œåœ¨æœ€æ–°ç‰ˆæœ¬ä¸­å¯ä»¥ä½¿ç”¨ vue ui è¿›è¡Œå¯è§†åŒ–åˆ›å»º
3.  å¦‚æœåˆ›å»ºçš„å­˜åœ¨ï¼Œéœ€è¦æç¤ºæ˜¯å¦è¦†ç›–

ç°åœ¨å¼€å§‹å§ ğŸ˜‰

#### 2.1 å®‰è£…ä¾èµ–

```
$ npm install commander --save
```

å®‰è£…å®Œæˆä¹‹å ğŸ‘‡

#### 2.2 åˆ›å»ºå‘½ä»¤

æ‰“å¼€ cli.js è¿›è¡Œç¼–è¾‘

```
#! /usr/bin/env node

const program = require('commander')

program
  // å®šä¹‰å‘½ä»¤å’Œå‚æ•°
  .command('create <app-name>')
  .description('create a new project')
  // -f or --force ä¸ºå¼ºåˆ¶åˆ›å»ºï¼Œå¦‚æœåˆ›å»ºçš„ç›®å½•å­˜åœ¨åˆ™ç›´æ¥è¦†ç›–
  .option('-f, --force', 'overwrite target directory if it exist')
  .action((name, options) => {
    // æ‰“å°æ‰§è¡Œç»“æœ
    console.log('name:',name,'options:',options)
  })
  
program
   // é…ç½®ç‰ˆæœ¬å·ä¿¡æ¯
  .version(`v${require('../package.json').version}`)
  .usage('<command> [option]')
  
// è§£æç”¨æˆ·æ‰§è¡Œå‘½ä»¤ä¼ å…¥å‚æ•°
program.parse(process.argv);
```

åœ¨å‘½ä»¤è¡Œè¾“å…¥ zrï¼Œæ£€æŸ¥ä¸€ä¸‹å‘½ä»¤æ˜¯å¦åˆ›å»ºæˆåŠŸ

```
~/Desktop/cli/zhurong-cli ->zr
Usage: zr <command> [option]

Options:
  -V, --version                output the version number
  -h, --help                   display help for command

Commands:
  create [options] <app-name>  create a new project
  help [command]               display help for command
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Commands ä¸‹é¢å·²ç»æœ‰äº† `create [options] <app-name>`ï¼Œæ¥ç€æ‰§è¡Œä¸€ä¸‹è¿™ä¸ªå‘½ä»¤

```
~/Desktop/cli/zhurong-cli ->zr create
error: missing required argument 'app-name'

~/Desktop/cli/zhurong-cli ->zr create my-project
æ‰§è¡Œç»“æœ >>> name: my-project options: {}

~/Desktop/cli/zhurong-cli ->zr create my-project -f
æ‰§è¡Œç»“æœ >>> name: my-project options: { force: true }

~/Desktop/cli/zhurong-cli ->zr create my-project --force
æ‰§è¡Œç»“æœ >>> name: my-project options: { force: true }
```

æˆåŠŸæ‹¿åˆ°å‘½ä»¤è¡Œè¾“å…¥ä¿¡æ¯ ğŸ‘

#### 2.3 æ‰§è¡Œå‘½ä»¤

åˆ›å»º lib æ–‡ä»¶å¤¹å¹¶åœ¨æ–‡ä»¶å¤¹ä¸‹åˆ›å»º create.js

```
// lib/create.js

module.exports = async function (name, options) {
  // éªŒè¯æ˜¯å¦æ­£å¸¸å–åˆ°å€¼
  console.log('>>> create.js', name, options)
}
```

åœ¨ cli.js ä¸­ä½¿ç”¨ create.js

```
// bin/cli.js

......
program
  .command('create <app-name>')
  .description('create a new project')
  .option('-f, --force', 'overwrite target directory if it exist') // æ˜¯å¦å¼ºåˆ¶åˆ›å»ºï¼Œå½“æ–‡ä»¶å¤¹å·²ç»å­˜åœ¨
  .action((name, options) => {
    // åœ¨ create.js ä¸­æ‰§è¡Œåˆ›å»ºä»»åŠ¡
    require('../lib/create.js')(name, options)
  })
......
```

æ‰§è¡Œä¸€ä¸‹ `zr create my-project`ï¼Œæ­¤æ—¶åœ¨ create.js æ­£å¸¸æ‰“å°äº†æˆ‘ä»¬å‡ºå…¥çš„ä¿¡æ¯

```
~/Desktop/cli/zhurong-cli ->zr create my-project
>>> create.js
my-project {}
```

åœ¨åˆ›å»ºç›®å½•çš„æ—¶å€™ï¼Œéœ€è¦æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼š**ç›®å½•æ˜¯å¦å·²ç»å­˜åœ¨ï¼Ÿ**

1.  å¦‚æœå­˜åœ¨
    -   å½“ `{ force: true }` æ—¶ï¼Œç›´æ¥ç§»é™¤åŸæ¥çš„ç›®å½•ï¼Œç›´æ¥åˆ›å»º
    -   å½“ `{ force: false }` æ—¶ è¯¢é—®ç”¨æˆ·æ˜¯å¦éœ€è¦è¦†ç›–
2.  å¦‚æœä¸å­˜åœ¨ï¼Œç›´æ¥åˆ›å»º

è¿™é‡Œç”¨åˆ°äº† fs çš„æ‰©å±•å·¥å…· [fs-extra](https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Ffs-extra "https://www.npmjs.com/package/fs-extra")ï¼Œå…ˆæ¥å®‰è£…ä¸€ä¸‹

```
# fs-extra æ˜¯å¯¹ fs æ¨¡å—çš„æ‰©å±•ï¼Œæ”¯æŒ promise 
$ npm install fs-extra --save
```

æˆ‘ä»¬æ¥ç€å®Œå–„ä¸€ä¸‹ create.js å†…éƒ¨çš„å®ç°é€»è¾‘

```
// lib/create.js

const path = require('path')
const fs = require('fs-extra')

module.exports = async function (name, options) {
  // æ‰§è¡Œåˆ›å»ºå‘½ä»¤

  // å½“å‰å‘½ä»¤è¡Œé€‰æ‹©çš„ç›®å½•
  const cwd  = process.cwd();
  // éœ€è¦åˆ›å»ºçš„ç›®å½•åœ°å€
  const targetAir  = path.join(cwd, name)

  // ç›®å½•æ˜¯å¦å·²ç»å­˜åœ¨ï¼Ÿ
  if (fs.existsSync(targetAir)) {

    // æ˜¯å¦ä¸ºå¼ºåˆ¶åˆ›å»ºï¼Ÿ
    if (options.force) {
      await fs.remove(targetAir)
    } else {
      // TODOï¼šè¯¢é—®ç”¨æˆ·æ˜¯å¦ç¡®å®šè¦è¦†ç›–
    }
  }
}
```

è¯¢é—®éƒ¨åˆ†çš„é€»è¾‘ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹æ–‡ç»§ç»­å®Œå–„

#### 2.3 åˆ›å»ºæ›´å¤šå‘½ä»¤

å¦‚æœæƒ³æ·»åŠ å…¶ä»–å‘½ä»¤ä¹Ÿæ˜¯åŒæ ·çš„å¤„ç†æ–¹å¼ï¼Œè¿™é‡Œå°±ä¸æ‰©å±•è¯´æ˜äº†ï¼Œç¤ºä¾‹å¦‚ä¸‹ ğŸ‘‡

```
// bin/cli.js

// é…ç½® config å‘½ä»¤
program
  .command('config [value]')
  .description('inspect and modify the config')
  .option('-g, --get <path>', 'get value from option')
  .option('-s, --set <path> <value>')
  .option('-d, --delete <path>', 'delete option from config')
  .action((value, options) => {
    console.log(value, options)
  })

// é…ç½® ui å‘½ä»¤
program
  .command('ui')
  .description('start add open roc-cli ui')
  .option('-p, --port <port>', 'Port used for the UI Server')
  .action((option) => {
    console.log(option)
  })
```

#### 2.4 å®Œå–„å¸®åŠ©ä¿¡æ¯

æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ vue-cli æ‰§è¡Œ --help æ‰“å°çš„ä¿¡æ¯

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ea06d4eaa8a344b9b74ea3286f2bd8fc~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

å¯¹æ¯” `zr --help` æ‰“å°çš„ç»“æœï¼Œç»“å°¾å¤„å°‘äº†ä¸€æ¡è¯´æ˜ä¿¡æ¯ï¼Œè¿™é‡Œæˆ‘ä»¬åšè¡¥å……ï¼Œé‡ç‚¹éœ€è¦æ³¨æ„**è¯´æ˜ä¿¡æ¯æ˜¯å¸¦æœ‰é¢œè‰²çš„**ï¼Œè¿™é‡Œå°±éœ€è¦ç”¨åˆ°æˆ‘ä»¬å·¥å…·åº“é‡Œé¢çš„ [chalk](https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fchalk "https://www.npmjs.com/package/chalk") æ¥å¤„ç†

```
// bin/cli.js

program
  // ç›‘å¬ --help æ‰§è¡Œ
  .on('--help', () => {
    // æ–°å¢è¯´æ˜ä¿¡æ¯
    console.log(`\r\nRun ${chalk.cyan(`zr <command> --help`)} for detailed usage of given command\r\n`)
  })

```

#### 2.5 æ‰“å°ä¸ª Logo

å¦‚æœæ­¤æ—¶æˆ‘ä»¬æƒ³ç»™è„šæ‰‹æ¶æ•´ä¸ª Logoï¼Œå·¥å…·åº“é‡Œçš„ [figlet](https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Ffiglet "https://www.npmjs.com/package/figlet") å°±æ˜¯å¹²è¿™ä¸ªçš„ ğŸ˜

```
// bin/cli.js

program
  .on('--help', () => {
    // ä½¿ç”¨ figlet ç»˜åˆ¶ Logo
    console.log('\r\n' + figlet.textSync('zhurong', {
      font: 'Ghost',
      horizontalLayout: 'default',
      verticalLayout: 'default',
      width: 80,
      whitespaceBreak: true
    }));
    // æ–°å¢è¯´æ˜ä¿¡æ¯
    console.log(`\r\nRun ${chalk.cyan(`roc <command> --help`)} show details\r\n`)
  })

```

æˆ‘ä»¬å†çœ‹çœ‹æ­¤æ—¶çš„ `zr --help` æ‰“å°å‡ºæ¥çš„æ˜¯ä¸ªä»€ä¹ˆæ ·å­

![WX20210519-224306@2x.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/83e5997df127452e8fe0f7b0bc1db70b~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

çœ‹èµ·æ¥è¿˜æ˜¯æŒºä¸é”™çš„ï¼Œå“ˆå“ˆ ğŸ˜„

### 3\. è¯¢é—®ç”¨æˆ·é—®é¢˜è·å–åˆ›å»ºæ‰€éœ€ä¿¡æ¯

è¿™é‡Œå¬å”¤æˆ‘ä»¬çš„è€æœ‹å‹ [inquirer](https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Finquirer "https://www.npmjs.com/package/inquirer")ï¼Œè®©ä»–æ¥å¸®æˆ‘ä»¬è§£å†³å‘½ä»¤è¡Œäº¤äº’çš„é—®é¢˜

**æ¥ä¸‹æ¥æˆ‘ä»¬è¦åšçš„ï¼š**

1.  ä¸Šä¸€æ­¥é—ç•™ï¼šè¯¢é—®ç”¨æˆ·æ˜¯å¦è¦†ç›–å·²å­˜åœ¨çš„ç›®å½•
2.  ç”¨æˆ·é€‰æ‹©æ¨¡æ¿
3.  ç”¨æˆ·é€‰æ‹©ç‰ˆæœ¬
4.  è·å–ä¸‹è½½æ¨¡æ¿çš„é“¾æ¥

#### 3.1 è¯¢é—®æ˜¯å¦è¦†ç›–å·²å­˜åœ¨çš„ç›®å½•

è¿™é‡Œè§£å†³ä¸Šä¸€æ­¥é—ç•™çš„é—®é¢˜ï¼š

1.  å¦‚æœç›®å½•å·²å­˜åœ¨
    -   å½“ `{ force: false }` æ—¶ è¯¢é—®ç”¨æˆ·æ˜¯å¦éœ€è¦è¦†ç›–

é€»è¾‘å®é™…ä¸Šå·²ç»å®Œæˆï¼Œè¿™é‡Œè¡¥å……ä¸€ä¸‹è¯¢é—®çš„å†…å®¹

é¦–é€‰æ¥å®‰è£…ä¸€ä¸‹ [inquirer](https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Ffiglet "https://www.npmjs.com/package/figlet")

```
$ npm install inquirer --save
```

ç„¶åè¯¢é—®ç”¨æˆ·æ˜¯å¦è¿›è¡Œ Overwrite

```
// lib/create.js

const path = require('path')

// fs-extra æ˜¯å¯¹ fs æ¨¡å—çš„æ‰©å±•ï¼Œæ”¯æŒ promise è¯­æ³•
const fs = require('fs-extra')
const inquirer = require('inquirer')

module.exports = async function (name, options) {
  // æ‰§è¡Œåˆ›å»ºå‘½ä»¤

  // å½“å‰å‘½ä»¤è¡Œé€‰æ‹©çš„ç›®å½•
  const cwd  = process.cwd();
  // éœ€è¦åˆ›å»ºçš„ç›®å½•åœ°å€
  const targetAir  = path.join(cwd, name)

  // ç›®å½•æ˜¯å¦å·²ç»å­˜åœ¨ï¼Ÿ
  if (fs.existsSync(targetAir)) {

    // æ˜¯å¦ä¸ºå¼ºåˆ¶åˆ›å»ºï¼Ÿ
    if (options.force) {
      await fs.remove(targetAir)
    } else {

      // è¯¢é—®ç”¨æˆ·æ˜¯å¦ç¡®å®šè¦è¦†ç›–
      let { action } = await inquirer.prompt([
        {
          name: 'action',
          type: 'list',
          message: 'Target directory already exists Pick an action:',
          choices: [
            {
              name: 'Overwrite',
              value: 'overwrite'
            },{
              name: 'Cancel',
              value: false
            }
          ]
        }
      ])

      if (!action) {
        return;
      } else if (action === 'overwrite') {
        // ç§»é™¤å·²å­˜åœ¨çš„ç›®å½•
        console.log(`\r\nRemoving...`)
        await fs.remove(targetAir)
      }
    }
  }
}
```

æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼š

1.  åœ¨å½“å‰ç›®å½•ï¼Œå³å‘½ä»¤è¡Œä¸­æ˜¾ç¤ºçš„ç›®å½•ä¸‹æ‰‹åŠ¨åˆ›å»º2ä¸ªç›®å½•ï¼Œè¿™é‡Œéšä¾¿å–åä¸º my-project å’Œ my-project2
2.  æ‰§è¡Œ `zr create my-project`ï¼Œæ•ˆæœå¦‚ä¸‹

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/74c9cb996fa04644a7dbcc2ea5039593~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

3.  æ‰§è¡Œ `zr create my-project2 --f`ï¼Œå¯ä»¥ç›´æ¥çœ‹åˆ° my-project2 è¢«ç§»é™¤

**âš ï¸æ³¨æ„ï¼šä¸ºä»€ä¹ˆè¿™é‡Œåªåšç§»é™¤ï¼Ÿ** å› ä¸ºåé¢è·å–åˆ°æ¨¡æ¿åœ°å€åï¼Œä¸‹è½½çš„æ—¶å€™ä¼šç›´æ¥åˆ›å»ºé¡¹ç›®ç›®å½•

#### 3.2 å¦‚ä½•è·å–æ¨¡ç‰ˆä¿¡æ¯

æ¨¡æ¿æˆ‘å·²ç»ä¸Šä¼ åˆ°è¿œç¨‹ä»“åº“ï¼š[github.com/zhurong-cli](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fzhurong-cli "https://github.com/zhurong-cli")

![WX20210520-221040.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b2fe38a3ee81465ca7c0235e5eb921ac~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

vue3.0-template ç‰ˆæœ¬ä¿¡æ¯ ğŸ‘‡

![WX20210520-220540.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/46ba6f0154264982bf0867b29cdca1e2~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

vue-template ç‰ˆæœ¬ä¿¡æ¯ ğŸ‘‡

![WX20210520-221400.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/74eedb3fe7a54164a48363c93d3f2156~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

github æä¾›äº†

-   [api.github.com/orgs/zhuronâ€¦](https://link.juejin.cn/?target=https%3A%2F%2Fapi.github.com%2Forgs%2Fzhurong-cli%2Frepos "https://api.github.com/orgs/zhurong-cli/repos") æ¥å£è·å–æ¨¡æ¿ä¿¡æ¯
-   [api.github.com/repos/zhuroâ€¦](https://link.juejin.cn/?target=https%3A%2F%2Fapi.github.com%2Frepos%2Fzhurong-cli%2F%24%257Brepo%257D%2Ftags "https://api.github.com/repos/zhurong-cli/$%7Brepo%7D/tags") æ¥å£è·å–ç‰ˆæœ¬ä¿¡æ¯

æˆ‘ä»¬åœ¨ lib ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª http.js ä¸“é—¨å¤„ç†æ¨¡æ¿å’Œç‰ˆæœ¬ä¿¡æ¯çš„è·å–

```
// lib/http.js

// é€šè¿‡ axios å¤„ç†è¯·æ±‚
const axios = require('axios')

axios.interceptors.response.use(res => {
  return res.data;
})


/**
 * è·å–æ¨¡æ¿åˆ—è¡¨
 * @returns Promise
 */
async function getRepoList() {
  return axios.get('https://api.github.com/orgs/zhurong-cli/repos')
}

/**
 * è·å–ç‰ˆæœ¬ä¿¡æ¯
 * @param {string} repo æ¨¡æ¿åç§°
 * @returns Promise
 */
async function  getTagList(repo) {
  return axios.get(`https://api.github.com/repos/zhurong-cli/${repo}/tags`)
}

module.exports = {
  getRepoList,
  getTagList
}
```

#### 3.3 ç”¨æˆ·é€‰æ‹©æ¨¡æ¿

æˆ‘ä»¬ä¸“é—¨æ–°å»ºä¸€ä¸ª Generator.js æ¥å¤„ç†é¡¹ç›®åˆ›å»ºé€»è¾‘

```
// lib/Generator.js

class Generator {
  constructor (name, targetDir){
    // ç›®å½•åç§°
    this.name = name;
    // åˆ›å»ºä½ç½®
    this.targetDir = targetDir;
  }

  // æ ¸å¿ƒåˆ›å»ºé€»è¾‘
  create(){

  }
}

module.exports = Generator;
```

åœ¨ create.js ä¸­å¼•å…¥ Generator ç±»

```
// lib/create.js

...
const Generator = require('./Generator')

module.exports = async function (name, options) {
  // æ‰§è¡Œåˆ›å»ºå‘½ä»¤

  // å½“å‰å‘½ä»¤è¡Œé€‰æ‹©çš„ç›®å½•
  const cwd  = process.cwd();
  // éœ€è¦åˆ›å»ºçš„ç›®å½•åœ°å€
  const targetAir  = path.join(cwd, name)

  // ç›®å½•æ˜¯å¦å·²ç»å­˜åœ¨ï¼Ÿ
  if (fs.existsSync(targetAir)) {
    ...
  }

  // åˆ›å»ºé¡¹ç›®
  const generator = new Generator(name, targetAir);

  // å¼€å§‹åˆ›å»ºé¡¹ç›®
  generator.create()
}

```

æ¥ç€æ¥å†™è¯¢é—®ç”¨æˆ·é€‰æ‹©æ¨¡ç‰ˆéƒ½é€»è¾‘

```
// lib/Generator.js

const { getRepoList } = require('./http')
const ora = require('ora')
const inquirer = require('inquirer')

// æ·»åŠ åŠ è½½åŠ¨ç”»
async function wrapLoading(fn, message, ...args) {
  // ä½¿ç”¨ ora åˆå§‹åŒ–ï¼Œä¼ å…¥æç¤ºä¿¡æ¯ message
  const spinner = ora(message);
  // å¼€å§‹åŠ è½½åŠ¨ç”»
  spinner.start();

  try {
    // æ‰§è¡Œä¼ å…¥æ–¹æ³• fn
    const result = await fn(...args);
    // çŠ¶æ€ä¸ºä¿®æ”¹ä¸ºæˆåŠŸ
    spinner.succeed();
    return result; 
  } catch (error) {
    // çŠ¶æ€ä¸ºä¿®æ”¹ä¸ºå¤±è´¥
    spinner.fail('Request failed, refetch ...')
  } 
}

class Generator {
  constructor (name, targetDir){
    // ç›®å½•åç§°
    this.name = name;
    // åˆ›å»ºä½ç½®
    this.targetDir = targetDir;
  }

  // è·å–ç”¨æˆ·é€‰æ‹©çš„æ¨¡æ¿
  // 1ï¼‰ä»è¿œç¨‹æ‹‰å–æ¨¡æ¿æ•°æ®
  // 2ï¼‰ç”¨æˆ·é€‰æ‹©è‡ªå·±æ–°ä¸‹è½½çš„æ¨¡æ¿åç§°
  // 3ï¼‰return ç”¨æˆ·é€‰æ‹©çš„åç§°

  async getRepo() {
    // 1ï¼‰ä»è¿œç¨‹æ‹‰å–æ¨¡æ¿æ•°æ®
    const repoList = await wrapLoading(getRepoList, 'waiting fetch template');
    if (!repoList) return;

    // è¿‡æ»¤æˆ‘ä»¬éœ€è¦çš„æ¨¡æ¿åç§°
    const repos = repoList.map(item => item.name);

    // 2ï¼‰ç”¨æˆ·é€‰æ‹©è‡ªå·±æ–°ä¸‹è½½çš„æ¨¡æ¿åç§°
    const { repo } = await inquirer.prompt({
      name: 'repo',
      type: 'list',
      choices: repos,
      message: 'Please choose a template to create project'
    })

    // 3ï¼‰return ç”¨æˆ·é€‰æ‹©çš„åç§°
    return repo;
  }

  // æ ¸å¿ƒåˆ›å»ºé€»è¾‘
  // 1ï¼‰è·å–æ¨¡æ¿åç§°
  // 2ï¼‰è·å– tag åç§°
  // 3ï¼‰ä¸‹è½½æ¨¡æ¿åˆ°æ¨¡æ¿ç›®å½•
  async create(){

    // 1ï¼‰è·å–æ¨¡æ¿åç§°
    const repo = await this.getRepo()
    
    console.log('ç”¨æˆ·é€‰æ‹©äº†ï¼Œrepo=' + repo)
  }
}

module.exports = Generator;
```

æµ‹è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹ç°åœ¨æ˜¯ä¸ªä»€ä¹ˆæ ·å­

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/61ca9d00cdd94af5ab5322ada3693ef0~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

æˆ‘é€‰æ‹©äº†é»˜è®¤çš„ vue-templateï¼Œæ­¤æ—¶

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d9ff4d63105540b38e222447c724acac~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

æˆåŠŸæ‹¿åˆ°æ¨¡æ¿åç§° repo çš„ç»“æœ âœŒï¸

#### 3.4 ç”¨æˆ·é€‰æ‹©ç‰ˆæœ¬

è¿‡ç¨‹å’Œ 3.3 ä¸€æ ·

```
// lib/generator.js

const { getRepoList, getTagList } = require('./http')
...

// æ·»åŠ åŠ è½½åŠ¨ç”»
async function wrapLoading(fn, message, ...args) {
  ...
}

class Generator {
  constructor (name, targetDir){
    // ç›®å½•åç§°
    this.name = name;
    // åˆ›å»ºä½ç½®
    this.targetDir = targetDir;
  }

  // è·å–ç”¨æˆ·é€‰æ‹©çš„æ¨¡æ¿
  // 1ï¼‰ä»è¿œç¨‹æ‹‰å–æ¨¡æ¿æ•°æ®
  // 2ï¼‰ç”¨æˆ·é€‰æ‹©è‡ªå·±æ–°ä¸‹è½½çš„æ¨¡æ¿åç§°
  // 3ï¼‰return ç”¨æˆ·é€‰æ‹©çš„åç§°

  async getRepo() {
    ...
  }

  // è·å–ç”¨æˆ·é€‰æ‹©çš„ç‰ˆæœ¬
  // 1ï¼‰åŸºäº repo ç»“æœï¼Œè¿œç¨‹æ‹‰å–å¯¹åº”çš„ tag åˆ—è¡¨
  // 2ï¼‰ç”¨æˆ·é€‰æ‹©è‡ªå·±éœ€è¦ä¸‹è½½çš„ tag
  // 3ï¼‰return ç”¨æˆ·é€‰æ‹©çš„ tag

  async getTag(repo) {
    // 1ï¼‰åŸºäº repo ç»“æœï¼Œè¿œç¨‹æ‹‰å–å¯¹åº”çš„ tag åˆ—è¡¨
    const tags = await wrapLoading(getTagList, 'waiting fetch tag', repo);
    if (!tags) return;
    
    // è¿‡æ»¤æˆ‘ä»¬éœ€è¦çš„ tag åç§°
    const tagsList = tags.map(item => item.name);

    // 2ï¼‰ç”¨æˆ·é€‰æ‹©è‡ªå·±éœ€è¦ä¸‹è½½çš„ tag
    const { tag } = await inquirer.prompt({
      name: 'tag',
      type: 'list',
      choices: tagsList,
      message: 'Place choose a tag to create project'
    })

    // 3ï¼‰return ç”¨æˆ·é€‰æ‹©çš„ tag
    return tag
  }

  // æ ¸å¿ƒåˆ›å»ºé€»è¾‘
  // 1ï¼‰è·å–æ¨¡æ¿åç§°
  // 2ï¼‰è·å– tag åç§°
  // 3ï¼‰ä¸‹è½½æ¨¡æ¿åˆ°æ¨¡æ¿ç›®å½•
  async create(){

    // 1ï¼‰è·å–æ¨¡æ¿åç§°
    const repo = await this.getRepo()

    // 2) è·å– tag åç§°
    const tag = await this.getTag(repo)
     
    console.log('ç”¨æˆ·é€‰æ‹©äº†ï¼Œrepo=' + repo + 'ï¼Œtag='+ tag)
  }
}

module.exports = Generator;
```

æµ‹è¯•ä¸€ä¸‹ï¼Œæ‰§è¡Œ `zr create my-project`

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b584c81cc000417fbfa8823bb2f4fca6~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

é€‰æ‹©å¥½äº†ä¹‹åï¼Œçœ‹çœ‹æ‰“å°ç»“æœ

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9990a61710c44c67bdaa80562558a075~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

åˆ°æ­¤è¯¢é—®çš„å·¥ä½œå°±ç»“æŸäº†ï¼Œå¯ä»¥è¿›è¡Œæ¨¡æ¿ä¸‹è½½äº†

### 4\. ä¸‹è½½è¿œç¨‹æ¨¡æ¿

ä¸‹è½½è¿œç¨‹æ¨¡ç‰ˆéœ€è¦ä½¿ç”¨ [download-git-repo](https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fdownload-git-repo "https://www.npmjs.com/package/download-git-repo") å·¥å…·åŒ…ï¼Œå®é™…ä¸Šå®ƒä¹Ÿåœ¨æˆ‘ä»¬ä¸Šé¢åˆ—çš„å·¥å…·èœå•ä¸Šï¼Œä½†æ˜¯åœ¨ä½¿ç”¨å®ƒçš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å®ƒæ˜¯**ä¸æ”¯æŒ promise**çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œéœ€è¦ä½¿ç”¨ ä½¿ç”¨ util æ¨¡å—ä¸­çš„ [promisify](https://link.juejin.cn/?target=http%3A%2F%2Fnodejs.cn%2Fapi%2Futil.html%23util_util_promisify_original "http://nodejs.cn/api/util.html#util_util_promisify_original") æ–¹æ³•å¯¹å…¶è¿›è¡Œ promise åŒ–

#### 4.1 å®‰è£…ä¾èµ–ä¸ promise åŒ–

```
$ npm install download-git-repo --save
```

è¿›è¡Œ promise åŒ–å¤„ç†

```
// lib/Generator.js

...
const util = require('util')
const downloadGitRepo = require('download-git-repo') // ä¸æ”¯æŒ Promise

class Generator {
  constructor (name, targetDir){
    ...

    // å¯¹ download-git-repo è¿›è¡Œ promise åŒ–æ”¹é€ 
    this.downloadGitRepo = util.promisify(downloadGitRepo);
  }
  
  ...
}
```

#### 4.2 æ ¸å¿ƒä¸‹è½½åŠŸèƒ½

æ¥ç€ï¼Œå°±æ˜¯æ¨¡æ¿ä¸‹è½½éƒ¨åˆ†çš„é€»è¾‘äº†

```
// lib/Generator.js

...
const util = require('util')
const path = require('path')
const downloadGitRepo = require('download-git-repo') // ä¸æ”¯æŒ Promise

// æ·»åŠ åŠ è½½åŠ¨ç”»
async function wrapLoading(fn, message, ...args) {
  ...
}

class Generator {
  constructor (name, targetDir){
    ...

    // å¯¹ download-git-repo è¿›è¡Œ promise åŒ–æ”¹é€ 
    this.downloadGitRepo = util.promisify(downloadGitRepo);
  }
  ...
  
  // ä¸‹è½½è¿œç¨‹æ¨¡æ¿
  // 1ï¼‰æ‹¼æ¥ä¸‹è½½åœ°å€
  // 2ï¼‰è°ƒç”¨ä¸‹è½½æ–¹æ³•
  async download(repo, tag){

    // 1ï¼‰æ‹¼æ¥ä¸‹è½½åœ°å€
    const requestUrl = `zhurong-cli/${repo}${tag?'#'+tag:''}`;

    // 2ï¼‰è°ƒç”¨ä¸‹è½½æ–¹æ³•
    await wrapLoading(
      this.downloadGitRepo, // è¿œç¨‹ä¸‹è½½æ–¹æ³•
      'waiting download template', // åŠ è½½æç¤ºä¿¡æ¯
      requestUrl, // å‚æ•°1: ä¸‹è½½åœ°å€
      path.resolve(process.cwd(), this.targetDir)) // å‚æ•°2: åˆ›å»ºä½ç½®
  }

  // æ ¸å¿ƒåˆ›å»ºé€»è¾‘
  // 1ï¼‰è·å–æ¨¡æ¿åç§°
  // 2ï¼‰è·å– tag åç§°
  // 3ï¼‰ä¸‹è½½æ¨¡æ¿åˆ°æ¨¡æ¿ç›®å½•
  // 4ï¼‰æ¨¡æ¿ä½¿ç”¨æç¤º
  async create(){

    // 1ï¼‰è·å–æ¨¡æ¿åç§°
    const repo = await this.getRepo()

    // 2) è·å– tag åç§°
    const tag = await this.getTag(repo)

    // 3ï¼‰ä¸‹è½½æ¨¡æ¿åˆ°æ¨¡æ¿ç›®å½•
    await this.download(repo, tag)
    
    // 4ï¼‰æ¨¡æ¿ä½¿ç”¨æç¤º
    console.log(`\r\nSuccessfully created project ${chalk.cyan(this.name)}`)
    console.log(`\r\n  cd ${chalk.cyan(this.name)}`)
    console.log('  npm run dev\r\n')
  }
}

module.exports = Generator;
```

å®Œæˆè¿™å—ï¼Œä¸€ä¸ªç®€å•çš„è„šæ‰‹æ¶å°±å®Œæˆäº† âœ…

æ¥è¯•ä¸€ä¸‹æ•ˆæœå¦‚ä½•ï¼Œæ‰§è¡Œ `zr create my-project`

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/da78f3e3e13a474fafc745f7ae67b8c3~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°æ¨¡æ¿å°±å·²ç»åˆ›å»ºå¥½äº† ğŸ‘ğŸ‘ğŸ‘

```
zhurong-cli                 
â”œâ”€ bin                      
â”‚  â””â”€ cli.js                
â”œâ”€ lib                      
â”‚  â”œâ”€ Generator.js          
â”‚  â”œâ”€ create.js             
â”‚  â””â”€ http.js               
â”œâ”€ my-project .............. æˆ‘ä»¬åˆ›å»ºçš„é¡¹ç›®             
â”‚  â”œâ”€ public                
â”‚  â”‚  â”œâ”€ favicon.ico        
â”‚  â”‚  â””â”€ index.html         
â”‚  â”œâ”€ src                   
â”‚  â”‚  â”œâ”€ assets             
â”‚  â”‚  â”‚  â””â”€ logo.png        
â”‚  â”‚  â”œâ”€ components         
â”‚  â”‚  â”‚  â””â”€ HelloWorld.vue  
â”‚  â”‚  â”œâ”€ App.vue            
â”‚  â”‚  â””â”€ main.js            
â”‚  â”œâ”€ README.md             
â”‚  â”œâ”€ babel.config.js       
â”‚  â””â”€ package.json          
â”œâ”€ README.md                
â”œâ”€ package-lock.json        
â””â”€ package.json             

```

### 5\. å‘å¸ƒé¡¹ç›®

ä¸Šé¢éƒ½æ˜¯åœ¨æœ¬åœ°æµ‹è¯•ï¼Œå®é™…åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯èƒ½å°±éœ€è¦å‘å¸ƒåˆ° npm ä»“åº“ï¼Œé€šè¿‡ npm å…¨å±€å®‰è£…ä¹‹åï¼Œç›´æ¥åˆ°ç›®æ ‡ç›®å½•ä¸‹é¢å»åˆ›å»ºé¡¹ç›®ï¼Œå¦‚ä½•å‘å¸ƒå‘¢ï¼Ÿ

1.  ç¬¬ä¸€æ­¥ï¼Œåœ¨ git ä¸Šå»ºå¥½ä»“åº“
2.  ç¬¬äºŒæ­¥ï¼Œå®Œå–„ package.json ä¸­çš„é…ç½®

```
{
  "name": "zhurong-cli",
  "version": "1.0.4",
  "description": "",
  "main": "index.js",
  "bin": {
    "zr": "./bin/cli.js"
  },
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "files": [
    "bin",
    "lib"
  ],
  "author": {
    "name": "T-Roc",
    "email": "lxp_work@163.com"
  },
  "keywords": [
    "zhurong-cli",
    "zr",
    "è„šæ‰‹æ¶"
  ],
  "license": "MIT",
  "dependencies": {
    "axios": "^0.21.1",
    "chalk": "^4.1.1",
    "commander": "^7.2.0",
    "download-git-repo": "^3.0.2",
    "figlet": "^1.5.0",
    "fs-extra": "^10.0.0",
    "inquirer": "^8.0.0",
    "ora": "^5.4.0"
  }
}

```

3.  ç¬¬ä¸‰æ­¥ï¼Œä½¿ç”¨ `npm publish` è¿›è¡Œå‘å¸ƒï¼Œæ›´æ–°åˆ°æ—¶å€™ï¼Œæ³¨æ„ä¿®æ”¹ç‰ˆæœ¬å·

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5ba9bddedd1d41288d35003fcbbf43f9~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

è¿™æ ·å°±å‘å¸ƒæˆåŠŸäº†ï¼Œæˆ‘ä»¬æ‰“å¼€ npm ç½‘ç«™æœç´¢ä¸€ä¸‹ ğŸ”

![WX20210522-220454@2x.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/76394ce2d2e0445c84f3478b611a610c~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

å·²ç»å¯ä»¥æ‰¾åˆ°å®ƒäº†ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ npm æˆ–è€… yarn å…¨å±€å®‰è£…ä½¿ç”¨äº†

ç‚¹æ­¤æ‰“å¼€ ğŸ‘‰ [zhurong-cli æºç åœ°å€](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FT-Roc%2Fzhurong-cli.git "https://github.com/T-Roc/zhurong-cli.git")

## å››ã€Yeomanï¼šä¸€ä¸ªé€šç”¨çš„è„šæ‰‹æ¶ç³»ç»Ÿ

![yeoman.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/14549fefe4ca4d0cbaa25a52d1dbb3ef~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

> Yeoman æœ€åˆå‘å¸ƒäº 2012 å¹´ï¼Œå®ƒæ˜¯ä¸€æ¬¾é«˜æ•ˆã€å¼€æºçš„ Web åº”ç”¨è„šæ‰‹æ¶ï¼ˆscaffoldingï¼‰è½¯ä»¶ï¼Œæ„åœ¨ç²¾ç®€è½¯ä»¶çš„å¼€å‘è¿‡ç¨‹ã€‚è„šæ‰‹æ¶è½¯ä»¶ç”¨äºå®ç°é¡¹ç›®ä¸­å¤šç§ä¸åŒçš„å·¥å…·å’Œæ¥å£çš„ååŒä½¿ç”¨ï¼Œä¼˜åŒ–é¡¹ç›®çš„ç”Ÿæˆè¿‡ç¨‹ã€‚å…è®¸åˆ›å»ºä»»ä½•ç±»å‹çš„åº”ç”¨ç¨‹åºï¼ˆWebï¼ŒJavaï¼ŒPythonï¼ŒCï¼ƒç­‰)ã€‚  

Yeoman å®é™…ä¸Šæ˜¯**ä¸‰ä¸ªå·¥å…·**çš„æ€»å’Œï¼š

-   yo --- è„šæ‰‹æ¶ï¼Œè‡ªåŠ¨ç”Ÿæˆå·¥å…·
-   gruntã€gulp --- æ„å»ºå·¥å…·
-   bowerã€npm --- åŒ…ç®¡ç†å·¥å…·

ä½¿ç”¨ Yeoman æ­å»ºè„šæ‰‹æ¶éå¸¸ç®€å•ï¼ŒYeoman æä¾›äº† `yeoman-generator` è®©æˆ‘ä»¬å¿«é€Ÿç”Ÿæˆä¸€ä¸ªè„šæ‰‹æ¶æ¨¡æ¿ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å„ç±» Generator å®ç°ä»»ä½•ç±»å‹çš„é¡¹ç›®æ­å»ºï¼Œä¸‹é¢æˆ‘ä»¬æ¥è¯•ä¸€ä¸‹ ğŸ¤“

### 1\. Yeoman åŸºç¡€ä½¿ç”¨

Yeoman æ˜¯ä¸€å¥—æ„å»ºç³»ç»Ÿï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬æ­å»ºè„šæ‰‹æ¶éœ€è¦ä½¿ç”¨çš„å°±æ˜¯ yo ğŸ‘‡

#### 1.1 å…¨å±€èŒƒå›´å®‰è£… yo

```
$ npm install yo --global # or yarn global add yo
```

#### 1.2 å®‰è£…å¯¹åº”çš„ generator

yo æ­é…ä¸åŒ `generator-xxx` å¯ä»¥åˆ›å»ºå¯¹åº”çš„é¡¹ç›®ï¼Œä¾‹å¦‚ `generator-webapp`ã€`generator-node`ã€`generator-vue` ç­‰ç­‰ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ `generator-node` æ¥æ¼”ç¤ºæ“ä½œã€‚

```
$ npm install generator-node --global # or yarn global add generator-node
```

#### 1.3 é€šè¿‡ yo è¿è¡Œ generator

```
$ mkdir yo-project
$ cd yo-project
$ yo node
```

è¿™æ ·æˆ‘ä»¬å°±é€šè¿‡ `yo + generator-node` å¿«æ·æ­å»ºä¸€ä¸ª node é¡¹ç›®ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ ğŸ‘‡

```
yo-project
â”œâ”€ .editorconfig
â”œâ”€ .eslintignore
â”œâ”€ .travis.yml
â”œâ”€ .yo-rc.json
â”œâ”€ LICENSE
â”œâ”€ README.md
â”œâ”€ lib
â”‚  â”œâ”€ __tests__
â”‚  â”‚  â””â”€ testCli.test.js
â”‚  â””â”€ index.js
â”œâ”€ package-lock.json
â””â”€ package.json          

```

å¦‚ä½•æŸ¥æ‰¾è‡ªå·±éœ€è¦çš„ generator å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥å»å®˜ç½‘ generators åˆ—è¡¨æœç´¢ ğŸ‘‰ [ç‚¹æ­¤è¿›å…¥](https://link.juejin.cn/?target=https%3A%2F%2Fyeoman.io%2Fgenerators%2F "https://yeoman.io/generators/")

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/818b143d85864d408f456de12dedf92d~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

è¿™ç§ä½¿ç”¨æ–¹å¼çœŸçš„éå¸¸çš„ç®€å•æ–¹ä¾¿ï¼Œä½†æ˜¯å®ƒçš„é—®é¢˜ä¹Ÿå¾ˆæ˜æ˜¾--**ä¸å¤Ÿçµæ´»**ï¼Œæ¯•ç«Ÿä¸åŒçš„å›¢é˜Ÿåœ¨ä½¿ç”¨çš„æŠ€æœ¯æ ˆä¸Šéƒ½æœ‰æ‰€å·®å¼‚ï¼Œ**å¦‚æœæˆ‘ä»¬æƒ³æ­å»ºè‡ªå·±æƒ³è¦çš„é¡¹ç›®ç»“æ„è¦æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ** æ¥ç€å¾€ä¸‹çœ‹ ğŸ‘‡

### 2\. è‡ªå®šä¹‰ Generator

è‡ªå®šä¹‰ Generator **å®é™…ä¸Šå°±æ˜¯åˆ›å»ºä¸€ä¸ªç‰¹å®šç»“æ„çš„ npm åŒ…**ï¼Œè¿™ä¸ªç‰¹å®šçš„ç»“æ„æ˜¯è¿™æ ·çš„ ğŸ‘‡

```
generator-xxx ............ è‡ªå®šä¹‰é¡¹ç›®ç›®å½•  
â”œâ”€ generators ............ ç”Ÿæˆå™¨ç›®å½•   
â”‚  â””â”€ app ................ é»˜è®¤ç”Ÿæˆå™¨ç›®å½•      
â”‚     â””â”€ index.js ........ é»˜è®¤ç”Ÿæˆå™¨å®ç°
â””â”€ package.json .......... æ¨¡å—åŒ…é…ç½®æ–‡ä»¶
```

æˆ–è€…è¿™æ ·çš„ ğŸ‘‡

```
generator-xxx   
â”œâ”€ app           
â”‚  â””â”€ index.js     
â”œâ”€ router        
â”‚  â””â”€ index.js   
â””â”€ package.json  
```

è¿™é‡Œæˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé¡¹ç›®çš„åç§°å¿…é¡»æ˜¯ `generator-<name>` æ ¼å¼ï¼Œæ‰å¯ä»¥æ­£å¸¸è¢« yo è¯†åˆ«å‡ºæ¥ï¼Œä¾‹å¦‚ä¸Šé¢ä¸¾ä¾‹ä½¿ç”¨çš„ generator-nodeã€‚

#### 2.1 åˆ›å»ºé¡¹ç›®

```
$ mkdir generator-simple # åˆ›å»ºé¡¹ç›®
$ cd generator-simple    # è¿›å…¥é¡¹ç›®ç›®å½•
```

#### 2.2 åˆå§‹åŒ– npm

```
$ npm init # or yarn init
```

ä¸€è·¯ enter ä¹‹åæˆ‘ä»¬å°±ç”Ÿæˆå¥½äº† package.jsonï¼Œä¸è¿‡æˆ‘ä»¬è¿˜éœ€è¦é¢å¤–æ£€æŸ¥ä¸€ä¸‹ï¼š

-   `name` å±æ€§å€¼é¡»æ˜¯ "generator-<name>"
-   `keyword` ä¸­å¿…é¡»åŒ…å« yeoman-generator
-   `files` å±æ€§è¦æŒ‡å‘é¡¹ç›®çš„æ¨¡æ¿ç›®å½•ã€‚

å®Œæˆä¸Šé¢çš„å·¥ä½œä¹‹åæˆ‘ä»¬çœ‹ä¸€ä¸‹ package.json æ˜¯ä¸ªä»€ä¹ˆæ ·å­

```
{
  "name": "generator-simple",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [ 
    "yeoman-generator" 
  ],
  "files": [
    "generators"
  ],
  "author": "ITEM",
  "license": "MIT"
}
```

âš ï¸æ³¨æ„ï¼šè¿™é‡Œå¦‚æœä½¿ç”¨çš„æ˜¯ç¬¬äºŒç§ç›®å½•ç»“æ„ï¼Œé‚£ä¹ˆ package.json ä¸­éœ€è¦åšç‚¹ä¿®æ”¹ ğŸ”§

```
{
  "files": [
    "app",
    "router"
  ]
}
```

#### 2.3 å®‰è£… `yeoman-generator`

`yeoman-generator` æ˜¯ Yeoman æä¾›çš„ä¸€ä¸ª Generator åŸºç±»ï¼Œè®©æˆ‘ä»¬åœ¨åˆ›å»ºè‡ªå®šä¹‰ Generator çš„æ—¶å€™æ›´åŠ ä¾¿æ·ã€‚

```
$ npm install yeoman-generator --save # or yarn add yeoman-generator 
```

#### 2.4 Generator åŸºç±»çš„ä½¿ç”¨è¯´æ˜

åœ¨ä»‹ç» Generator åŸºç±»ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥å®ç°ä¸€ä¸ªç®€å•çš„ ğŸŒ°

é¦–å…ˆæ‰“å¼€æ ¸å¿ƒå…¥å£æ–‡ä»¶ï¼Œç¼–è¾‘å†…å®¹å¦‚ä¸‹ ğŸ‘‡

```
// ï½/generators/app/index.js

// æ­¤æ–‡ä»¶ä½œä¸º Generator çš„æ ¸å¿ƒå…¥å£
// éœ€è¦å¯¼å‡ºä¸€ä¸ªç»§æ‰¿è‡ª Yeoman Generator çš„ç±»å‹
// Yeoman Generator åœ¨å·¥ä½œæ—¶ä¼šè‡ªåŠ¨è°ƒç”¨æˆ‘ä»¬åœ¨æ­¤ç±»å‹ä¸­å®šä¹‰çš„ä¸€äº›ç”Ÿå‘½å‘¨æœŸæ–¹æ³•
// æˆ‘ä»¬åœ¨è¿™äº›æ–¹æ³•ä¸­å¯ä»¥é€šè¿‡è°ƒç”¨çˆ¶ç±»æä¾›çš„ä¸€äº›å·¥å…·æ–¹æ³•å®ç°ä¸€äº›åŠŸèƒ½ï¼Œä¾‹å¦‚æ–‡ä»¶å†™å…¥

const Generator = require('yeoman-generator');

module.exports = class extends Generator {
  // add your own methods
  method1() {
    console.log('I am a custom method');
  }
  method2() {
    console.log('I am a custom method2');
  }
};

```

å®Œæˆä¹‹åï¼Œæˆ‘ä»¬é€šè¿‡ `npm link` çš„æ–¹å¼æŠŠé¡¹ç›®é“¾æ¥åˆ°å…¨å±€

```
$ npm link # or yarn link
```

è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨å…¨å±€å»è®¿é—®åˆ° generator-simple é¡¹ç›®äº†ï¼Œæˆ‘ä»¬æ¥è¯•ä¸€ä¸‹

```
$ yo simple
```

çœ‹ä¸€ä¸‹æ§åˆ¶å°çš„è¾“å‡º

```
I am a custom method1
I am a custom method2
```

OKï¼Œæ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœ ğŸ˜

âš ï¸ **æ³¨æ„**ï¼Œå¦‚æœè¿è¡Œ`yo simple` å‡ºç°ä¸‹é¢çš„é”™è¯¯

```
This generator (simple:app) 
requires yeoman-environment at least 3.0.0, current version is 2.10.3,
try reinstalling latest version of 'yo' or use '--ignore-version-check' option
```

å¯ä»¥è¿™æ ·å¤„ç†ï¼š

æ–¹æ¡ˆä¸€

```
# å¸è½½å½“å‰ç‰ˆæœ¬
npm uninstall yeoman-generator

# å®‰è£…ä½ç‰ˆæœ¬çš„åŒ…
npm i yeoman-generator@4.13.0

# æ‰§è¡Œ
yo simple
```

æ–¹æ¡ˆäºŒ

```
# å…¨å±€å®‰è£…æ¨¡å—
npm i -g yeoman-environment

# æ–°çš„æ‰§è¡Œæ–¹å¼(yoeæ²¡æœ‰æ‰“é”™)
yoe run simple
```

ä»ä¸Šé¢çš„å° ğŸŒ° æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è‡ªå®šä¹‰æ–¹æ³•æ˜¯è‡ªåŠ¨é¡ºåºæ‰§è¡Œï¼ŒGenerator åŸºç±»ä¹Ÿæä¾›äº†ä¸€äº›é¡ºåºæ‰§è¡Œçš„æ–¹æ³•ï¼Œç±»ä¼¼äºç”Ÿå‘½å‘¨æœŸä¸€æ ·ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æœ‰å“ªäº› ğŸ‘‡

> 1.  `initializing` -- åˆå§‹åŒ–æ–¹æ³•ï¼ˆæ£€æŸ¥çŠ¶æ€ã€è·å–é…ç½®ç­‰ï¼‰  
>     
> 2.  `prompting` -- è·å–ç”¨æˆ·äº¤äº’æ•°æ®ï¼ˆthis.prompt()ï¼‰  
>     
> 3.  `configuring` -- ç¼–è¾‘å’Œé…ç½®é¡¹ç›®çš„é…ç½®æ–‡ä»¶  
>     
> 4.  `default` -- å¦‚æœ Generator å†…éƒ¨è¿˜æœ‰ä¸ç¬¦åˆä»»æ„ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ä»»åŠ¡åçš„æ–¹æ³•ï¼Œå°†ä¼šè¢«æ”¾åœ¨ default è¿™ä¸ªä»»åŠ¡ä¸‹è¿›è¡Œè¿è¡Œ  
>     
> 5.  `writing` -- å¡«å……é¢„ç½®æ¨¡æ¿  
>     
> 6.  `conflicts` -- å¤„ç†å†²çªï¼ˆä»…é™å†…éƒ¨ä½¿ç”¨ï¼‰  
>     
> 7.  `install` -- è¿›è¡Œä¾èµ–çš„å®‰è£…ï¼ˆegï¼šnpmï¼Œbowerï¼‰  
>     
> 8.  `end` -- æœ€åè°ƒç”¨ï¼Œåšä¸€äº› clean å·¥ä½œ  
>     

#### 2.5 å¼€å§‹æˆ‘ä»¬çš„è‡ªå®šä¹‰ Generator

æˆ‘ä»¬å€ŸåŠ© Generator æä¾›çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯¹å…¥å£æ–‡ä»¶æ”¹é€ ä¸€ä¸‹

```
// ï½/generators/app/index.js

const Generator = require('yeoman-generator');

module.exports = class extends Generator {
  // yo ä¼šè‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³•
  writing () {
    // æˆ‘ä»¬ä½¿ç”¨ Generator æä¾›çš„ fs æ¨¡å—å°è¯•å¾€ç›®å½•ä¸­å†™å…¥æ–‡ä»¶
    this.fs.write(
      // destinationPath() åŸºäºé¡¹ç›®åœ°å€
      this.destinationPath('temp.txt'), // å†™å…¥åœ°å€
      Math.random().toString() // å†™å…¥å†…å®¹
    )
  }
};
```

è¿è¡Œä¸€ä¸‹çœ‹çœ‹

```
$ yo simple
```

è¿™ä¸ªæ—¶å€™ï¼Œæ§åˆ¶å°è¾“å‡ºå‡º `create temp.txt`ï¼Œæˆ‘ä»¬æ‰“å°ä¸€ä¸‹ç›®å½•ç»“æ„

```
generator-simple      
â”œâ”€ generators         
â”‚  â””â”€ app             
â”‚     â””â”€ index.js     
â”œâ”€ package-lock.json  
â”œâ”€ package.json       
â””â”€ temp.txt .............. writing ä¸­åˆ›å»ºçš„æ–‡ä»¶        
```

æ‰“å¼€æ–°åˆ›å»ºçš„ temp.txt ç…ç…

```
0.8115477932475306
```

å¯ä»¥çœ‹åˆ°æ–‡ä»¶ä¸­å†™å…¥äº†ä¸€ä¸²éšæœºæ•°ã€‚

åœ¨å®é™…ä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡æ¨¡æ¿å»åˆ›å»ºå¤šä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦è¿™æ ·å¤„ç† ğŸ‘‡

**é¦–å…ˆ**ï¼Œåˆ›å»ºæ¨¡æ¿æ–‡ä»¶ç›®å½• `./generators/app/templates/`ï¼Œå¹¶åœ¨æ–‡ä»¶å¤¹ä¸­æ–°å¢ä¸€ä¸ªæ¨¡æ¿æ–‡ä»¶ `temp.html`

```
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- yo æ”¯æŒ ejs è¯­æ³• -->
  <title><%= title %></title>
</head>
<body>
  <% if (success) { %>
    <h1>è¿™é‡Œæ˜¯æ¨¡ç‰ˆæ–‡ä»¶<%= title %></h1>
  <% } %>
</body>
</html>
```

**ç„¶å**ï¼Œä¿®æ”¹ä¸€ä¸‹å…¥å£æ–‡ä»¶ ğŸ‘‡

```
// ï½/generators/app/index.js

const Generator = require('yeoman-generator');

module.exports = class extends Generator {
  // yo ä¼šè‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³•
  writing () {
    // æˆ‘ä»¬ä½¿ç”¨ Generator æä¾›çš„ fs æ¨¡å—å°è¯•å¾€ç›®å½•ä¸­å†™å…¥æ–‡ä»¶
    // this.fs.write(
    //   this.destinationPath('temp.txt'),
    //   Math.random().toString()
    // )

    // æ¨¡ç‰ˆæ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤æŒ‡å‘ templates
    const tempPath = this.templatePath('temp.html')
    // è¾“å‡ºç›®æ ‡è·¯å¾„
    const output = this.destinationPath('index.html')
    // æ¨¡æ¿æ•°æ®ä¸Šä¸‹æ–‡
    const context = { title: 'Hello ITEM ~', success: true}

    this.fs.copyTpl(tempPath, output, context)
  }
};
```

**å®Œæˆä¹‹å**ï¼Œ`yo simple` è¿è¡Œä¸€ä¸‹ï¼Œè¿™æ ·æˆ‘ä»¬å°±åœ¨æ ¹ç›®å½•ä¸‹å¾—åˆ°äº† `index.html`ï¼Œæ‰“å¼€çœ‹çœ‹ ğŸ¤“

```
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- æ”¯æŒ ejs è¯­æ³• -->
  <title>Hello ITEM ~</title>
</head>
<body>
  
    <h1>è¿™é‡Œæ˜¯æ¨¡ç‰ˆæ–‡ä»¶Hello ITEM ~</h1>

</body>
</html>
```

ejs å†™å…¥çš„å˜é‡ï¼Œéƒ½å·²ç»è¢«æ•°æ®æˆåŠŸæ›¿æ¢äº† âœŒï¸

**æ¥ä¸‹æ¥**ï¼Œæˆ‘ä»¬è¦å¦‚ä½•é€šè¿‡å‘½ä»¤è¡Œäº¤äº’è·å–ç”¨æˆ·è‡ªå®šä¹‰çš„ä¸€äº›æ•°æ®ï¼Œä¾‹å¦‚ï¼šé¡¹ç›®åç§°ã€ç‰ˆæœ¬å·ç­‰ç­‰ã€‚

è¿™ä¸ªå°±éœ€è¦å€ŸåŠ© Generator æä¾›çš„ Promting æ¥å¤„ç†å‘½ä»¤è¡Œçš„ä¸€äº›äº¤äº’

```
// ï½/generators/app/index.js

const Generator = require('yeoman-generator');

module.exports = class extends Generator {
  // åœ¨æ­¤æ–¹æ³•ä¸­å¯ä»¥è°ƒç”¨çˆ¶ç±»çš„ prompt() æ–¹æ³•ä¸ç”¨æˆ·è¿›è¡Œå‘½ä»¤è¡Œè¯¢é—®
  prompting(){
    return this.prompt([
      {
        type: 'input', // äº¤äº’ç±»å‹
        name: 'name', 
        message: 'Your project name', // è¯¢é—®ä¿¡æ¯
        default: this.appname // é¡¹ç›®ç›®å½•åç§°ï¼Œè¿™é‡Œæ˜¯ generator-simple
      }
    ])
    .then(answers => {
      console.log(answers) // æ‰“å°è¾“å…¥å†…å®¹
      this.answers = answers // å­˜å…¥ç»“æœï¼Œå¯ä»¥åœ¨åé¢ä½¿ç”¨
    })
  }
  // yo ä¼šè‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³•
  writing () {
    ......
  }
};
```

ä¿å­˜ä¹‹åï¼Œå†è¿è¡Œ `yo simple`

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4d7360ec81a6422793f8befa4bcacc40~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

æˆ‘ä»¬çœ‹åˆ°å‘½ä»¤è¡Œè¯¢é—®äº† `Your Project name ?`ï¼Œåœ¨ç”¨æˆ·è¾“å…¥å®Œæˆä¹‹åï¼Œæˆ‘ä»¬æ‹¿åˆ°äº† anwsersï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨æ¥ä¸‹æ¥çš„æµç¨‹é‡Œé¢å»ä½¿ç”¨è¿™ä¸ªç»“æœã€‚

```
// ï½/generators/app/index.js
...
// æ¨¡æ¿æ•°æ®ä¸Šä¸‹æ–‡
 writing () {
    ...
    // æ¨¡æ¿æ•°æ®ä¸Šä¸‹æ–‡
    const context = { title: this.answers.name, success: true}

    this.fs.copyTpl(tempPath, output, context)
  }
...
```

å†è¿è¡Œä¸€ä¸‹ `yo simple`ï¼ŒæŸ¥çœ‹è¾“å‡ºçš„ index.html

```
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- æ”¯æŒ ejs è¯­æ³• -->
  <title>my-project</title>
</head>
<body>
  
    <h1>è¿™é‡Œæ˜¯æ¨¡ç‰ˆæ–‡ä»¶my-project</h1>
  
</body>
</html>
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç”¨æˆ·è¾“å…¥çš„å†…å®¹ `{ name: 'my-project' }` å·²ç»æ˜¾ç¤ºåœ¨æˆ‘ä»¬çš„ index.html é‡Œé¢äº† ğŸ‘Œ

ç‚¹æ­¤æ‰“å¼€ ğŸ‘‰ [generator-simple æºç åœ°å€](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FT-Roc%2Fgenerator-simple "https://github.com/T-Roc/generator-simple")

yeoman å°±ä»‹ç»åˆ°è¿™é‡Œï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹å¦å¤–ä¸€æ¬¾è„šæ‰‹æ¶å·¥å…· -- plop ğŸ‘‡

## äº”ã€plopï¼šä¸€æ¬¾å°è€Œç¾çš„è„šæ‰‹æ¶å·¥å…·

> plop å°åœ¨ä½“ç§¯è½»é‡ï¼Œç¾åœ¨ç®€å•æ˜“ç”¨

æ›´å¤šä½¿ç”¨æ–¹æ³• ğŸ‘‰ [plop ä½¿ç”¨æ–‡æ¡£](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fplopjs%2Fplop "https://github.com/plopjs/plop")

æˆ‘ä»¬å¯ä»¥å°†å…¶ç›´æ¥é›†æˆåˆ°é¡¹ç›®ä¸­ï¼Œè§£å†³ä¸€ä¸‹é‡å¤æ€§çš„æ´»ç€éœ€è¦æ ‡å‡†åŒ–çš„åˆ›å»ºå·¥ä½œï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥åšä¸ªå°æ¡ˆä¾‹ï¼Œæ¯”å¦‚

**æˆ‘ä»¬å·²ç»çº¦å®šå¥½äº†ç»„ä»¶çš„åˆ›å»ºè§„èŒƒ**ï¼š

-   ç»„ä»¶åç§°ä½¿ç”¨å¤§é©¼å³°
-   æ ·å¼éœ€è¦å•ç‹¬æ‹§å‡ºæ¥å†™
-   éœ€è¦æ­é…è¯´æ˜æ–‡æ¡£

**plop çš„ä½¿ç”¨è¿‡ç¨‹å¤§è‡´å¯ä»¥æ‹†è§£ä¸º**ï¼š

1.  å®‰è£… plopï¼Œæ–°å¢é…ç½®æ–‡ä»¶ plopfile.js
2.  ç¼–è¾‘ plop é…ç½®æ–‡ä»¶
3.  åˆ›å»ºæ¨¡æ¿æ–‡ä»¶
4.  æ‰§è¡Œåˆ›å»ºä»»åŠ¡

ä¸‹é¢è¿›å…¥ coding ç¯èŠ‚

### 1\. å®‰è£… plop

é¦–å…ˆç”¨æˆ‘ä»¬çš„ zhurong-cli åˆå§‹åŒ–ä¸€ä¸ª vue é¡¹ç›®

```
# å…¨å±€å®‰è£…
$ npm install zhurong-cli -g 
# åˆ›å»º vue é¡¹ç›®
$ zr create plop-demo
```

æˆ‘ä»¬è¿™é‡Œä¸ºäº†å›¢é˜Ÿç»Ÿä¸€ä½¿ç”¨ï¼Œplop ç›´æ¥å°±é›†æˆåˆ°é¡¹ç›®ä¹‹ä¸­

```
$ npm install plop --save-dev
```

é¡¹ç›®ç›®å½•ä¸‹é¢åˆ›å»º plop çš„é…ç½®æ–‡ä»¶ plopfile.js

### 2\. ç¼–è¾‘ plop é…ç½®æ–‡ä»¶

```
// ./plopfile.js

module.exports = plop => {
  plop.setGenerator('component', {
    // æè¿°
    description: 'create a component',
    // è¯¢é—®ç»„ä»¶çš„åç§°
    prompts: [
      {
        type: 'input',
        name: 'name',
        message: 'Your component name',
        default: 'MyComponent'
      }
    ],
    // è·å–åˆ°å›ç­”å†…å®¹åç»­çš„åŠ¨ä½œ
    actions: [
      //æ¯ä¸€ä¸ªå¯¹è±¡éƒ½æ˜¯ä¸€ä¸ªåŠ¨ä½œ
      {
        type: 'add', // ä»£è¡¨æ·»åŠ æ–‡ä»¶
        // è¢«åˆ›å»ºæ–‡ä»¶çš„è·¯å¾„åŠåç§°
        // name ä¸ºç”¨æˆ·è¾“å…¥çš„ç»“æœï¼Œä½¿ç”¨ {{}} ä½¿ç”¨å˜é‡
        // properCase: plop è‡ªå¸¦æ–¹æ³•ï¼Œå°† name è½¬æ¢ä¸ºå¤§é©¼å³°
        path: 'src/components/{{ properCase name }}/index.vue',
        // æ¨¡æ¿æ–‡ä»¶åœ°å€
        templateFile: 'plop-templates/component.vue.hbs'
      },
      {
        type: 'add',
        path: 'src/components/{{ properCase name }}/index.scss',
        templateFile: 'plop-templates/component.scss.hbs'
      },
      {
        type: 'add',
        path: 'src/components/{{ properCase name }}/README.md',
        templateFile: 'plop-templates/README.md.hbs'
      }
    ]
  })
}

```

ä¸Šé¢ç”¨åˆ° properCase æ–¹æ³•å°† name è½¬åŒ–ä¸ºå¤§é©¼å³°ï¼Œå…¶ä»–æ ¼å¼è¿˜åŒ…æ‹¬ ğŸ‘‡

-   `camelCase`: changeFormatToThis
-   `snakeCase`: change\_format\_to\_this
-   `dashCase/kebabCase`: change-format-to-this
-   `dotCase`: change.format.to.this
-   `pathCase`: change/format/to/this
-   `properCase/pascalCase`: ChangeFormatToThis
-   `lowerCase`: change format to this
-   `sentenceCase`: Change format to this,
-   `constantCase`: CHANGE\_FORMAT\_TO\_THIS
-   `titleCase`: Change Format To This

æˆ‘ä»¬çœ‹åˆ°ä¸Šé¢å·²ç»å¼•ç”¨äº†æ¨¡æ¿æ–‡ä»¶ï¼Œå®é™…ä¸Šæˆ‘ä»¬è¿˜æ²¡åˆ›å»ºï¼Œæ¥ç€åˆ›å»ºä¸€ä¸‹

### 3\. åˆ›å»ºæ¨¡æ¿æ–‡ä»¶

é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹é¢åˆ›å»º plop-templates æ–‡ä»¶å¤¹ï¼Œé‡Œé¢åˆ›å»ºå¯¹åº”çš„æ¨¡æ¿æ–‡ä»¶

```
plop-templates         
â”œâ”€ README.md.hbs ............... è¯´æ˜æ–‡æ¡£æ¨¡æ¿     
â”œâ”€ component.scss.hbs .......... ç»„ä»¶æ ·å¼æ¨¡æ¿
â””â”€ component.vue.hbs ........... ç»„ä»¶æ¨¡æ¿
```

æ¨¡æ¿å¼•æ“æˆ‘ä»¬ç”¨åˆ°æ˜¯ Handlebars ï¼Œæ›´å¤šè¯­æ³•è¯´æ˜ ğŸ‘‰ [Handlebars ä¸­æ–‡ç½‘](https://link.juejin.cn/?target=https%3A%2F%2Fwww.handlebarsjs.cn%2F "https://www.handlebarsjs.cn/")

ç¼–è¾‘ component.scss.hbs

```
{{!-- ./plop-templates/component.scss.hbs --}}
{{!-- dashCase/kebabCase: change-format-to-this --}}
{{!-- name: è¾“å…¥æ¨¡æ¿åç§° --}}

.{{ dashCase name }} {

}
```

ç¼–è¾‘ component.vue.hbs

```
{{!-- ./plop-templates/component.vue.hbs --}}

<template>
  <div class="{{ dashCase name }}">{{ name }}</div>
</template>

<script>
  export default {
    name: '{{ properCase name }}',
  }
</script>

<style lang="scss">
@import "./index.scss";

</style>
```

ç¼–è¾‘ README.md.hbs

```
{{!-- ./plop-templates/README.md.hbs --}}

è¿™é‡Œæ˜¯ç»„ä»¶ {{ name }} çš„ä½¿ç”¨è¯´æ˜
```

è¡¥å……è¯´æ˜ï¼š

-   è¿™é‡Œæ¨¡æ¿éƒ½æ˜¯æœ€ç®€å•å®ç°ï¼Œå®é™…ç”Ÿäº§ä¸­å¯ä»¥æ ¹æ®éœ€æ±‚ä¸°å¯Œæ¨¡æ¿å†…å®¹
-   æ¨¡æ¿ä¸­çš„ dashCaseã€properCase ä¸ºå˜æ›´ name å‘½ä»¤çš„æ˜¾ç¤ºè§„åˆ™ï¼Œä¸Šæ–‡å·²ç»åˆ—è¡¨è¿‡
    -   `dashCase`ï¼šå˜ä¸ºæ¨ªçº¿é“¾æ¥ aa-bb-cc
    -   `properCase`ï¼šå˜ä¸ºå¤§é©¼å³° AaBbCc
    -   `...`
-   Handlebars ä¸­ä½¿ç”¨å˜é‡ï¼Œç”¨ `{{}}` åŒ…è£¹

### 4\. æ‰§è¡Œåˆ›å»ºä»»åŠ¡

æ‰“å¼€ package.json

```
// scripts ä¸­ å¢åŠ ä¸€æ¡å‘½ä»¤
...
"scripts": {
    ...
    "plop": "plop"
  },
...  
```

æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ `npm run plop` æ¥åˆ›å»ºç»„ä»¶äº†

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4983f9db608347f4b952f8de27c6bd3e~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5dceca1b12194d4b94503ea0a73ee8ad~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp)

å¾ˆå¿«ç»„ä»¶å°±åˆ›å»ºå®Œæˆäº† âœ…

æ­¤æ—¶çœ‹ä¸€ä¸‹ components æ–‡ä»¶å¤¹ä¸‹é¢

```
components         
â”œâ”€ MyApp           
â”‚  â”œâ”€ README.md    
â”‚  â”œâ”€ index.scss   
â”‚  â””â”€ index.vue    
â””â”€ HelloWorld.vue  
```

å·²ç»åˆ›å»ºäº† MyApp çš„ç»„ä»¶äº†ï¼Œé‡Œé¢çš„æ–‡ä»¶æˆ‘ä»¬ä¹Ÿæ‰“å¼€çœ‹çœ‹

æ‰“å¼€ MyApp/index.vue

```
<template>
  <div class="my-app">my-app</div>
</template>

<script>
  export default {
    name: 'MyApp',
  }
</script>

<style lang="scss">
@import "./index.scss";

</style>
```

æ‰“å¼€ MyApp/index.scss

```
.my-app {

}
```

æ‰“å¼€ MyApp/README.md

```
è¿™é‡Œæ˜¯ç»„ä»¶ my-app çš„ä½¿ç”¨è¯´æ˜
```

ç‚¹æ­¤æ‰“å¼€ ğŸ‘‰ [plop-demo æºç åœ°å€](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FT-Roc%2Fplop-demo "https://github.com/T-Roc/plop-demo")

## å…­ã€å†™åœ¨æœ€å

ä¸çŸ¥é“å¤§å®¶çœ‹å®Œè¿™ç¯‡æ–‡ç« ï¼Œå­¦åºŸäº†å— ğŸ˜‚

æœ¬ç¯‡æ–‡ç« æ•´ç†äº†å¾ˆä¹…ï¼Œå¸Œæœ›å¯¹å¤§å®¶çš„å­¦ä¹ æœ‰æ‰€å¸®åŠ© ğŸ˜

å¦å¤–ä¹Ÿå¸Œæœ›å¤§å®¶å¯ä»¥ **ç‚¹èµ è¯„è®º å…³æ³¨** æ”¯æŒä¸€ä¸‹ï¼Œæ‚¨çš„æ”¯æŒå°±æ˜¯å†™ä½œçš„åŠ¨åŠ› ğŸ˜˜

é¢„å‘Šä¸€ä¸‹ï¼Œä¸‹ä¸€ç¯‡å°†å¸¦æ¥ ğŸ‘‰ **æ‰“åŒ…ä¸æ„å»ºå·¥å…·ç›¸å…³çš„çŸ¥è¯†ä½“ç³»**

___

**å‚è€ƒæ–‡ç« ï¼š**

[github.com/CodeLittlePâ€¦](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FCodeLittlePrince%2Fgenerator-zx-vue%2Fblob%2Fmaster%2Fgenerators%2Fapp%2Findex.js "https://github.com/CodeLittlePrince/generator-zx-vue/blob/master/generators/app/index.js")  
[cli.vuejs.org/zh/guide/crâ€¦](https://link.juejin.cn/?target=https%3A%2F%2Fcli.vuejs.org%2Fzh%2Fguide%2Fcreating-a-project.html "https://cli.vuejs.org/zh/guide/creating-a-project.html")  
[yeoman.io/authoring/iâ€¦](https://link.juejin.cn/?target=https%3A%2F%2Fyeoman.io%2Fauthoring%2Findex.html "https://yeoman.io/authoring/index.html")  
[www.jianshu.com/p/93211004câ€¦](https://link.juejin.cn/?target=https%3A%2F%2Fwww.jianshu.com%2Fp%2F93211004c5ac "https://www.jianshu.com/p/93211004c5ac")